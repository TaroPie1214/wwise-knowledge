# 将工程升级到 Wwise 2023.1

|  |
| --- |
| Wwise Unreal Integration Documentation |

将工程升级到 Wwise 2023.1

# Spatial Audio

## Integration Settings

在 23.1 之前，Spatial Audio 使用 Integration Settings 存储查询表。然后，将其保存在 DefaultGame.ini 文件中。用户或工程中的素材更改可能会修改部分查询表，而这往往会导致 DefaultGame.ini 文件处于未同步状态。 **AcousticTextureParamsMap** 此数组之前存储工程中所有 Acoustic Texture 的吸收值。现已从 DefaultGame.ini 中移除并将其设为专用。 **AkGeometryMap** 此数组之前将工程的 Physical Material 与 Acoustic Texture 和 Transmission Loss 值关联。现已将其替换为行类型为 FWwiseGeometrySurfacePropertiesRow 的 Data Table 素材。在更新至 23.1 时，会创建新的素材并将 AkGeometryMap 的内容移到其中。新的素材会与 Integration Settings 的 Geometry Surface Properties Table 属性关联。为了移除无效的行，还添加了新的 "Verify and Update" 按钮。 **EnvironmentDecayAuxBusMap** 此数组之前将 Reverb Decay 值与 Reverb Auxiliary Bus 关联。现已将其替换为行类型为 FWwiseDecayAuxBusRow 的 Data Table 素材。在更新至 23.1 时，会创建新的素材并将 EnvironmentDecayAuxBusMap 的内容移到其中。新的素材会与 Integration Settings 的 Reverb Assignment Table 属性关联。

## Reverb Estimation 服务

在 23.1 之前，Unreal 中的 Reverb Estimation 服务使用 Project Settings 中定义的 Default Surface Absorption 值估算 Room 的衰减。现在使用 Room 的 Acoustic Texture 吸收值估算所述衰减。对于指定了 Acoustic Texture 的 Room，衰减值可能会有变化。若未为 Room 指定 Acoustic Texture，则使用 Default Surface Absorption 值。

## 连续射线投射

Spatial Audio 会使用射线追踪引擎来高效地估算反射和衍射路径。在之前的 Wwise 版本中，在发声体或听者的移动超出预定阈值（参见 Movement Threshold Spatial Audio Setting）时，会投射一定数量的射线，并重新计算反射和衍射路径。射线投射和重新计算会增加该帧的负荷，进而导致 CPU 用量达到峰值。在 Wwise 2023.1 中，会在每一帧连续投射射线，直到触发重新计算。藉此，可将射线投射的负荷分摊到多个帧，从而避免 CPU 用量达到峰值。 为此，将 **Number Of Primary Rays** Spatial Audio Setting 的**默认值**由 100 降到了 35。在迁移后，务必重新估算工程的最佳初级射线数。

## 严密的几何构造

在 23.1 中，我们引入了一些新的 Spatial Audio 功能。它们要求 Room 的几何构造是严密的。这样方便计算几何包含关系以及与过渡区的距离。也就是说，几何构造中不能有开口；每个边缘要刚好连接两个三角形。在将 Room 发送到 Spatial Audio 时，会对 Room 的几何构造进行搜索来查找边界边缘。只要找到边界边缘，就说明几何构造是不严密的。这时会显示错误消息。 若 Room 处在 Reverb Zone 中，其几何构造必须是严密的。若遇到错误消息，请查找开口和边界边缘来修复几何构造。对此，可使用 Transmission Loss 值为 0 的表面来覆盖开口。若没有明显的开口，请查找边缘或表面重叠造成的边界边缘。 注意，若依赖 Spatial Audio 执行 Room 几何包含关系检测，也要确保几何构造是严密的。不过，Unreal 集成 并不默认使用此功能。在任何其他情况下，都可忽略错误消息。

# 弃用

已在 2022.1.0 Unreal 集成 中弃用并在 2023.1.0 Unreal 集成 中移除以下函数、Blueprint 节点和属性：

## 移除的函数

- **FAkAudioInputManager**：
  - **PostAudioInputEvent**：移除了 **EventName** 参数。
- **UAkComponent**：
  - **PostAkEvent**：移除了 **EventName** 参数。
  - **PostAkEventAndWaitForEnd**：移除了 **EventName** 参数。
  - **PostAkEventByIdWithCallback**：改用 **PostAkEvent**。
  - **PostAkEventByNameWithDelegate**：改用 **PostAkEvent**。
  - **PostAssociatedAkEventAndWaitForEndAsync**：改用 **PostAkEventAndWaitForEnd**。
  - **UseEarlyReflections**
- **UAkGameObject**：
  - **PostAkEvent**：移除了 **EventName** 参数。
  - **PostAkEventAsyncByEvent**：改用 **PostAkEvent**。
  - **PostAkEventByNameWithDelegate**：改用 **PostAkEvent**。
  - **GetRTPCValue**
- **FAkAudioDevice**：
  - **PostAkAudioEventOnActor**：改用 **UAkAudioEvent::PostOnActor**。
  - **PostAkAudioEventOnComponent**：改用 **UAkAudioEvent::PostOnComponent**。
  - **PostEventOnActor**：改用 **UAkAudioEvent::PostOnActor**。
  - **PostEventOnGameObjectID**：改用 **UAkAudioEvent::PostOnGameObjectID**。
  - **PostEventOnActorWithLatentAction**：改用 **UAkAudioEvent::PostOnActor**。
  - **PostEventOnComponentWithLatentAction**：改用 **UAkAudioEvent::PostOnComponent**。
  - **PostEventOnAkComponent**：改用 **UAkAudioEvent::PostOnComponent**。
  - **PostEventOnAkGameObject**：改用 **UAkAudioEvent::PostOnAkGameObject**。
  - **PostAkAudioEventAtLocation**：改用 **UAkAudioEvent::PostAtLocation**。
  - **PostAkAudioEventAtLocationAsync**：改用 **UAkAudioEvent::PostAtLocation**。
  - **PostAkAudioEventOnActorAsync**：改用 **UAkAudioEvent::PostOnActor**。
  - **PostAkAudioEventOnAkGameObjectAsync**：改用 **UAkAudioEvent::PostOnAkGameObject**。
  - **PostAkAudioEventWithLatentActionOnActorAsync**：改用 **UAkAudioEvent::PostOnActor**。
  - **PostAkAudioEventWithLatentActionOnAkComponentAsync**：改用 **UAkAudioEvent::PostOnComponent**。
  - **ExecuteActionOnEvent**：改用 **UAkAudioEvent::ExecuteAction**。
  - **ExecuteActionOnPlayingID**：改用 **UAkAudioEvent::ExecuteAction**。

## 移除的 Blueprint 节点

- **PostAndWaitForEndOfEventAsync**：改用 **PostAndWaitForEndOfEvent** 或 **UAkAudioEvent::PostOnActorAndWait**。
- **PostEventByName**：改用 **PostEvent** 或 **UAkAudioEvent::PostOnActor**。
- **PostEventAtLocationByName**：改用 **UAkAudioEvent::PostAtLocation**。
- **PostEventAtLocation**：移除了 **EventName** 参数。
- **ExecuteActionOnEvent**：改用 **UAkAudioEvent::ExecuteAction**。
- **UseEarlyReflections**
- **ClearBanks**
- **LoadBankByName**
- **UnloadBankByName**

## 移除的属性

- **UAkComponent**：
  - **EarlyReflectionOrder**
  - **EarlyReflectionMaxPathLength**
  - **roomReverbAuxBusGain**
  - **diffractionMaxEdges**
  - **diffractionMaxPaths**
  - **diffractionMaxPathLength**
- **UAkGameObject**：
  - **EventName**