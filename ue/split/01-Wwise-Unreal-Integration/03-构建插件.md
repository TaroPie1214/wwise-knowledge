# 构建插件

|  |
| --- |
| Wwise Unreal Integration Documentation |

构建插件

`WwiseSoundEngine.Build.cs` 文件（位于 `…\Plugins\Wwise\Source\WwiseSoundEngine\WwiseSoundEngine.Build.cs`）负责针对每个支持的平台为插件设置构建参数。此文件专门：

- 指定要链接哪些静态库；
- 指定要在运行时加载哪些动态库；
- 定义用于控制各种集成功能的预处理器宏。

# 预处理器定义

`WwiseSoundEngine.Build.cs` 中加入了以下预处理器定义：

- `WWISE_CONFIGURATION_DIR`   
  此设置用于指定 Wwise 构建配置 – AkSoundEngine 库所在的相应子文件夹。
- `WWISE_DSP_DIR`   
  此设置用于指定 Wwise 构建配置 – 插件库（静态库和动态库）所在的相应子文件夹。
- `AK_SUPPORT_OPUS`   
  此设置用于声明 Wwise Opus 库可供使用。
- `AK_SUPPORT_WAAPI`   
  此设置用于声明 Wwise Authoring API 库可供使用。
- `AK_UNREAL_MAX_CONCURRENT_IO`   
  此设置用于指定允许发生的最大并发读取和写入数。

# 从源代码构建 Wwise Unreal 集成

对于以下平台，将把 `ThirdParty` 内对应 `bin` 文件夹中的所有 Wwise 插件打包到最终可执行文件中：

- Android
- iOS
- tvOS
- Switch

对于 Android，有个 UPL 文件位于 `…\Plugins\Wwise\Source\WwiseSoundEngine_{WWISE_MAJOR}_{WWISE_MINOR}\Wwise_APL.xml`，用来声明将把所有共享库打包到最终可执行文件中以构建库的基础架构。

对于 iOS 和 tvOS，会在 `…\Plugins\Wwise\Source\WwiseSoundEngine\Public\Generated\AkiOSPlugins.h` 头文件内处理插件注册。此文件在 SoundBank 生成期间生成并包含在 `…\Plugins\Wwise\Source\WwiseSoundEngine_{WWISE_MAJOR}_{WWISE_MINOR}\Private\Wwise\API_{WWISE_MAJOR}_{WWISE_MINOR}\WwiseSoundEngineAPI_{WWISE_MAJOR}_{WWISE_MINOR}.cpp` 内。

对于 Switch，会在 `…\Plugins\Wwise\Source\WwiseSoundEngine\Public\Generated\AkSwitchPlugins.h` 头文件内处理插件注册。此文件在 SoundBank 生成期间生成并包含在 `…\Plugins\Wwise\Source\WwiseSoundEngine_{WWISE_MAJOR}_{WWISE_MINOR}\Private\Wwise\API_{WWISE_MAJOR}_{WWISE_MINOR}\WwiseSoundEngineAPI_{WWISE_MAJOR}_{WWISE_MINOR}.cpp` 内。

For Switch 2, plug-in registration is handled within the `…\Plugins\Wwise\Source\WwiseSoundEngine\Public\Generated\AkSwitch2Plugins.h` header. 此文件在 SoundBank 生成期间生成并包含在 `…\Plugins\Wwise\Source\WwiseSoundEngine_{WWISE_MAJOR}_{WWISE_MINOR}\Private\Wwise\API_{WWISE_MAJOR}_{WWISE_MINOR}\WwiseSoundEngineAPI_{WWISE_MAJOR}_{WWISE_MINOR}.cpp` 内。

The plug-in registration header is not generated during a BuildCookRun operation. Before you run a BuildCookRun operation, do one of the following:

- If the plug-in registration header already exists, commit it to source control for build machine usage.
- Add a prebuild step to the `[ProjectName].Target.cs` file that opens and closes the editor. For example: `"[EngineInstallDir]\Engine\Binaries\Win64\UnrealEditor-Cmd.exe" "[ProjectPath]\[ProjectName].uproject" -ExecCmds="Automation Quit" -unattended -NullRHI`

|  |  |
| --- | --- |
|  | **注記：** To reduce the size of the shipped executable, users are encouraged to remove unused shared libraries from the `bin` folder within `…\Plugins\WwiseSoundEngine\ThirdParty`. |

对于以下平台，将把共享动态库添加到所生成 `…\Binaries\<UEPlatform>\<TargetName>.target` 文件中的运行时依赖项列表。

- Linux
- Mac
- PS4
- PS5
- Windows（用于插件）
- XboxOne
- XboxSeriesX

在正确执行 [安装](installation.html) (安装) 章节中列出的安装步骤之后，可按照与 Unreal Engine 相同的方式来重构 Wwise Unreal 集成。 有关此操作的详细说明，请参阅[设置制作管线](https://dev.epicgames.com/documentation/en-us/unreal-engine/setting-up-your-production-pipeline-in-unreal-engine)。

有关插件及源代码的详细信息，请参阅[插件中的代码](https://dev.epicgames.com/documentation/en-us/unreal-engine/plugins-in-unreal-engine#codeinplugins)。

## Integrating custom Wwise plug-ins

If you have developed your own custom Wwise plug-in, the standard procedure applies for the platforms that do not support shared libraries (iOS, tvOS, and Switch). For all other platforms, compile your plug-in as a dynamic library and put it in the following directory:

`..\Plugins\WwiseSoundEngine\ThirdParty\[PLATFORM]\[CONFIGURATION]\bin`

# Unreal 和 Wwise SoundEngine 配置

在 Unreal 中，设有以下配置状态：Debug、DebugGame、Development、Test 和 Shipping（详见[编译配置参考](https://dev.epicgames.com/documentation/en-us/unreal-engine/build-configurations-reference-for-unreal-engine)）。

在 Wwise SoundEngine 中，提供以下构建配置：Debug、Profile 和 Release（详见[构建配置参考](https://www.audiokinetic.com/library/edge/?source=SDK&id=goingfurther_builds.html)）。

对于所有平台，Wwise 和 Unreal 构建配置存在以下关联：

- Unreal Debug 和 DebugGame 配置状态与 Wwise SoundEngine Debug 配置对应。
- Unreal Development 配置状态与 Wwise SoundEngine Profile 配置对应。
- Unreal Test 和 Shipping 配置状态与 Wwise SoundEngine Release 配置对应。

# Windows 上的 Unreal 和 Wwise SoundEngine 配置

在 Windows 上，SDK 为 Debug、Profile 和 Release 版本的声音引擎提供动态和静态版本的 C 运行时库。静态库存放在名称中包含 `(StaticCRT)` 的文件夹中。

Wwise Unreal 集成 使用 StaticCRT AkSoundEngine 库（若不可用，则改用动态版本的 AkSoundEngine 库）

不过，对于 Wwise 动态库，在完全采用 `bDebugBuildsActuallyUseDebugCRT` 设置构建 Unreal 工程时只能使用 Debug 构建配置。有关相应构建设置的详细信息，请参阅 [编译配置参考](https://dev.epicgames.com/documentation/en-us/unreal-engine/build-configurations-reference-for-unreal-engine) 。

WAAPI 的 AkAutobahn 库使用了与 Unreal 不兼容的 C++ 设置。所以只要使用该库，就会改用 Profile 版本的动态 DLL。