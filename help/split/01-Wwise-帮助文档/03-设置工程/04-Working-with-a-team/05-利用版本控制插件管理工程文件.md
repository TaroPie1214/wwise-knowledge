# 利用版本控制插件管理工程文件

[Wwise 帮助文档](../../00-Wwise-帮助文档.md) > [设置工程](../00-设置工程.md) > [Working with a team](00-Working-with-a-team.md) > 利用版本控制插件管理工程文件

## 利用版本控制插件管理工程文件

Wwise 的开放架构便于通过使用或创建版本控制插件来集成版本控制软件。版本控制插件会在 Wwise 和版本控制软件之间建立链接，以便直接在 Wwise 中管理文件并执行版本控制功能（如签入和签出）。

因为每个版本控制系统的工作机制都不一样，所以具体可用的功能和采用的工作流程将取决于所用系统。

为了帮助用户快速入门，Wwise 针对 Perforce® 和 Subversion 软件配置管理系统配套提供了两个功能完备的示例版本控制插件。Perforce 和 Subversion 均不采用锁定-修改-解锁模式，而采用复制-修改-合并模式。在这种模式下，团队的各个成员可读取存储库或文档库并创建客户端工作区。此工作区是一个目录，里面包含工作站上文件和/或工程的个人工作副本。这样，团队的各个成员都可以并行工作，修改他们自己的个人副本。 做 Prepare 时，各个成员可以将他们的个人副本合并到一个新的最终版本中去。若存在冲突，可借助版本控制系统完成合并。不过，最终要由您来正确解决各种问题。

如果您在使用别的版本控制管理系统，可为 Wwise 创建自己的版本控制插件。如需了解如何创建和集成自己的版本控制插件，请参阅 SDK 文档中的[如何创建版本控制插件 DLL](https://www.audiokinetic.com/library/?source=SDK&id=source__control__dll.html) 章节。

您可以在 Project Settings（工程设置）对话框中选择并配置版本控制插件。有关详细信息，请参阅[“配置版本控制插件”一节](../01-处理工程/02-定义工程设置/01-定义工程的常规设置.md#configuring_source_control_plug_ins "配置版本控制插件")。

在使用版本控制插件时，Wwise 中可直接使用众多的版本控制功能。例如在使用 Perforce 插件时，可以在 Wwise 中执行下列版本控制操作：

- **Get latest version** —— 通过从文档库中检索最新版本来更新工作副本。
- **Submit changes** —— 将待提交的文件发送到 Perforce 服务器进行处理。
- **Check out** —— 在客户端工作区中创建文档库文件的工作副本。
- **Lock** —— 锁定文件，使其它客户端无法将文件的工作副本提交到服务器。
- **Unlock** —— 解锁文件，使其它客户端可以将文件的工作副本提交到服务器。
- **Mark for add** —— 将文件添加到文档库。当文件被标记为添加时，它将被添加到更改列表（changelist），然后必须将它提交到文档库。
- **Mark for delete** —— 将文件从文档库中删除。当文件被标记为删除时，它将被放置到更改列表中，然后必须将它提交到要删除它的文档库中。
- **Move** —— 在 Originals 目录中的文件夹之间移动源文件。
- **Rename** —— 重命名文档库中的文件。
- **Revert changes** —— 放弃您对客户端工作区中的某文件所做的更改。
- **Resolve** —— 调解文件两个修订版本之间的差异。
- **Diff** —— 将客户端工作区中的文件与文档库中的文件进行比较。
- **File History** —— 显示文件的修订历史记录。

|  |  |
| --- | --- |
| [备注] | 备注 |
| Subversion 插件中支持一系列类似的版本控制功能。 |

您不仅可以在 Wwise 中访问这些版本控制命令，还可通过 Project Explorer 中显示的专用叠加图标来快速识别 Work Unit 文件的状态。下表举例展示了 Perforce 版本控制插件中使用的叠加图标。

| 叠加图标 | 名称 | 描述 |
| --- | --- | --- |
| |  | | --- | |  | | Normal (not checked out) | 文件处于最新状态，没有人将它 check-out。 |
| |  | | --- | |  | | Marked for add  Moved | 文件已被标记为添加到 Perforce 文档库或者被移动过了因而带有 move／add（移动/添加）状态。 |
| |  | | --- | |  | | Checked out (Open for Edit) | 文件已从 Perforce 文档库中登出。 |
| |  | | --- | |  | | Checked out by another user | 文件已被团队中的另一用户签出。 |
| |  | | --- | |  | | Concurrently checked out | 文件已被您和团队中的另一用户签出。 |
| |  | | --- | |  |  |  | | --- | |  | | Outdated（非文件的最新修订版） | 服务器上存在一个更新的修订版本。您可以获取文件的最新版本。 |

  

|  |  |
| --- | --- |
| [备注] | 备注 |
| "Checked out by another user"、"Concurrently Checked out" 和 "Outdated" 图标仅在 Perforce 版本控制插件中可用。 |

### Supported Perforce/Subversion versions

在使用所述版本控制插件之前，请检查以下信息来确保 Perforce 或 Subversion 的版本与版本控制插件兼容。

- Perforce: The Perforce Source Control plug-in was built using the Perforce SDK version 2022.1, but should work with most versions of the Perforce servers. 若使用了与版本控制插件不兼容的不同 Perforce 版本，可使用 Wwise SDK 中的源码及所用版本来重新构建插件。有关 Perforce 插件的详细信息，请参阅 [Wwise SDK 文档](https://www.audiokinetic.com/library/?source=SDK&id=referencematerial__samplecode__source__control.html#referencematerial_samplecode_source_control_perforce)。
- Subversion (deprecated): The Subversion Source Control plug-in has been
  deprecated since Wwise 2023.1 and will no longer be updated.

  Subversion 版本控制插件采用 Subversion 1.8.5 构建。若使用了与版本控制插件不兼容的不同 Subversion 版本，可使用 Wwise SDK 中的源码及所用版本来重新构建插件。For more information about rebuilding the Subversion plug-in, see the Wwise SDK documentation.

  Subversion 的 bin 文件夹在默认情况下位于 C:\Program Files\Subversion\bin 下，必须在系统的 PATH 环境变量中设置这个文件夹路径。Subversion 安装程序通常会将这条路径添加到 PATH 中，但是，如果从上文提到的 ZIP 文件手动安装 Subversion，您则必须将 Bin 文件夹手动添加到 PATH 中去。

以下章节阐述了如何使用版本控制插件来管理素材。虽然其内容主要针对 Perforce 版本控制插件，不过使用 Subversion 时的工作流程与之类似。

|  |  |
| --- | --- |
| [技巧] | 技巧 |
| Perforce、Subversion 和其他 Platform SDK 的更新都会在我们 SDK Documentation 的 [版本说明](https://www.audiokinetic.com/library/?source=SDK&id=releasenotes.html) 部分发布。 |

### Setting up your project files in Perforce

在使用 Perforce 版本控制插件之前，您或系统管理员需要执行以下操作：

- 在每位团队成员的工作站上安装并设置版本控制管理软件的客户端版本。
- 在每位团队成员的工作站上配置客户端工作区。
- 从文档库中获取工程文件的最新版本，并将它们保存在客户端工作区中。
- 在 Wwise 中选择并配置版本控制插件。

有关安装和配置 Perforce 的详细信息，请联系系统管理员或参阅 Perforce 文档。

您可以在 Project Settings（工程设置）对话框中选择并配置版本控制插件。有关详细信息，请参阅[“配置版本控制插件”一节](../01-处理工程/02-定义工程设置/01-定义工程的常规设置.md#configuring_source_control_plug_ins "配置版本控制插件")。

### Adding files to Perforce

在开始开发工程前，应将工程文件和音频源添加到文档库或资源库。将文件添加到 Perforce 包括以下两个步骤：

- [将文件添加到更改列表的方法是：](05-利用版本控制插件管理工程文件.md#to_add_files_to_changelist "将文件添加到更改列表的方法是：").
- [将您的更改提交到文档库的方法是：](05-利用版本控制插件管理工程文件.md#to_submit_changes_to_depot "将您的更改提交到文档库的方法是：").

|  |  |
| --- | --- |
| [备注] | 备注 |
| 在创建新的 Work Unit 或将新的音频文件导入到工程中时，系统会提示您标记这些新文件以便添加到 Perforce 中。 |

**将文件添加到更改列表的方法是：**

1. 在菜单栏中，依次单击 **Project** > **File Manager**（工程 > 文件管理器）。

   File Manager 将打开 。
2. 切换到以下某个选项卡：

   - Work Units，将工作单元添加到 Perforce
   - Sources，将音频文件添加到 Perforce。
3. 选择您要添加到 Perforce 的文件。
4. 右键点击选定的工程文件，并从菜单中选择 **Mark for add**。

   The Process Log dialog opens showing that the selected file has been added to the changelist or “opened for add” and is ready to be submitted to the depot.
5. 点击 **OK** 以关闭 Process Log。

   文件的状态设置为“add”。
6. 点击 **Close** 以关闭 File Manager。

   在 Project Explorer 中，工程文件此刻便有了 Marked for add 叠加图标。

   此时，这些文件只是刚被添加到更改列表中而已，您还需要提交更改列表，以将这些新文件 check-in 到文档库。有关将文件提交到文档库的详细信息，请参阅[“Submitting your changes to the Perforce depot”一节](05-利用版本控制插件管理工程文件.md#submitting_changes_to_perforce_depot "Submitting your changes to the Perforce depot")。
7. 保存工程。

### Checking out files from the Perforce depot for editing

在编辑工程中的文件前，首先应该将它们 check-out，确保您的客户端工作区中有这些文件的最新版本。在 Perforce 中 check-out 文件时，这些文件变成可写状态。这意味着您可以保存对文件所做的更改。

在默认情况下，Perforce 不执行排他性 check-out，这意味着团队的其它成员可以同时处理同一文件。沟通是避免出现合并冲突的关键，解决合并冲突耗时又费力。

**check-out 文件进行编辑的方法是：**

1. 在菜单栏中，依次单击 **Project** > **File Manager**（工程 > 文件管理器）。

   File Manager 将打开 。
2. 切换到以下某个选项卡：

   - Work Units，将工作单元添加到 Perforce
   - Sources，将音频文件添加到 Perforce。
3. 选择您要打开进行编辑的文件。
4. 右键点击选定的工程文件之一，然后从菜单中选择 **Check out**。

   The Process Log dialog opens showing that the file has been checked out or “opened for edit.”
5. 点击 **OK** 以关闭 Process Log。

   文件的状态设置为“edit”。
6. 点击 **Close** 以关闭 File Manager。

   在 Project Explorer 中，工程文件上于是有了 Checked out 叠加图标。

|  |  |
| --- | --- |
| [备注] | 备注 |
| 在启用工程设置 **Prompt for checkout on edit** 时，若对未签出的文件实施更改，则将打开 Pending Source Control Operations 对话框。若要签出实施了更改的文件，请选择 **Check out modified files** 选项并单击 **OK**。若要撤消相应更改以免触发该对话框，请单击 **Cancel**。若取消选中 **Check out modified files** 选项并单击 **OK**，则允许继续实施更改。不过，若尝试保存工程，则将再次提示签出文件。有关详细信息，请参阅[“General 选项卡”一节](../../09-参考主题/01-工程/08-Project-Settings/01-General-选项卡.md "General 选项卡")。 |

### Submitting your changes to the Perforce depot

如果处理完特定文件或者希望团队中的其它成员可以访问您的更改，您则可以将文件重新提交到文档库。非常重要的是，您需要详细描述所做的更改，以便您和其他人能充分了解文件中更改的范围。在处理冲突时，这些备注可能会很有用。

在将文件重新提交到文档库时，Perforce 会将您的更改合并到文档库中已有的文件中。如果存在任何冲突，则必须先解决冲突，然后文件才能成功地提交到文档库。

**将您的更改提交到文档库的方法是：**

1. 在菜单栏中，依次单击 **Project** > **File Manager**（工程 > 文件管理器）。

   File Manager 将打开 。
2. 点击 **Submit Changes** 按钮，然后点击以下其中某个选项：

   - **Work Units** —— 仅发送工作单元到服务器进行登入。
   - **Sources** —— 仅发送源文件到服务器进行登入。
   - **All** - Sends all pending files (Work Units and source files) to the server for check-in.

   The Submit Changes dialog opens.
3. 如果您不想将特定文件 check-in 到服务器，则可取消选择这些文件，然后点击 **OK**。
4. 右键点击选定的工程文件之一，然后从菜单中选择 **Submit Changes**。

   The Description dialog opens.
5. 输入您对文件所做的更改的详细描述。

   |  |  |
   | --- | --- |
   | [备注] | 备注 |
   | 若要用双字节字符在描述部分填写变更，例如使用日语或中文字符，请将P4系统环境变量 `P4CHARSET` 设置为 `utf8`。 |
6. 如果您想在提交更改后立即继续编辑文件，请选择 **Check out file(s) after submit** 选项。
7. 单击 **OK**（确定）。

   The Process Log dialog opens showing that the files have been checked in or “submitted.”
8. 点击 **OK** 以关闭 Process Log。

   文件的状态设置为“normal”。
9. 点击 **Close** 以关闭 File Manager。

   在 Project Explorer 中，除非您选择了  **Check out file(s) after submit** 选项，否则工程文件将带有 Checked in 叠加图标。

**将单个文件提交到文档库的方法是：**

1. 在菜单栏中，依次单击 **Project** > **File Manager**（工程 > 文件管理器）。

   File Manager 将打开 。
2. 切换到以下某个选项卡：

   - Work Units，将工作单元添加到 Perforce
   - Sources，将音频文件添加到 Perforce。
3. 选择您要提交的文件。
4. 右键点击选定的工程文件之一，然后从菜单中选择 **Submit Changes**。

   The Description dialog opens.
5. 输入您对文件所做的更改的详细描述。

   |  |  |
   | --- | --- |
   | [备注] | 备注 |
   | 若要用双字节字符在描述部分填写变更，例如使用日语或中文字符，请将P4系统环境变量 `P4CHARSET` 设置为 `utf8`。 |
6. 如果您想在提交更改后立即继续编辑文件，请选择 **Check out file(s) after submit** 选项。
7. 单击 **OK**（确定）。

   The Process Log dialog opens showing that the files have been checked in or “submitted.”
8. 点击 **OK** 以关闭 Process Log。

   文件的状态设置为“normal”。
9. 点击 **Close** 以关闭 File Manager。

   在 Project Explorer（工程资源管理器）中，除非选择了 **Check out file(s) after submit**（在提交后签出文件）选项，否则现在工程文件会带有 Checked in（已签入）叠加图标。

   |  |  |
   | --- | --- |
   | [技巧] | 技巧 |
   | 您也可以通过在 Project Explorer 中右键单击 Work Unit 并依次选择 **Source Control** > **Submit Changes** 来将更改提交到 Perforce 文档库。 |

### Comparing your files with the files in the Perforce depot

您可以将客户端工作区中的文件与文档库中文件的最新版本进行比较，以确定两个文件之间是否存在差异。在比较文件之前应该保存工程，以便您使用文件的最新版本进行比较。

**将您的文件与文档库的文件进行比较的方法是：**

1. 在菜单栏中，依次单击 **Project** > **File Manager**（工程 > 文件管理器）。

   File Manager 将打开 。
2. 右键点击您要比较的工作单元文件，然后从菜单中选择 **Diff**。

   默认的 Perforce 差异查看器（diff viewer）中显示两个文件之间的差异。
3. 查看两个文件之间的差异。
4. 查看完差异后，关闭 Perforce 以返回 Wwise。

### Moving source files within the Originals folder using Perforce

您可以在工程的 Originals 文件夹中移动源文件，但在这样做之前，应确保其它团队成员没有在使用这些文件。如果您移动一个已被其他人 check-out 的文件，则那些人在试图将更改提交到文档库中去时将遇到问题。

当 Perforce 移动文件时，它将打开当前文件以待删除，并在新位置中创建该文件的一个完全副本。这些文件不会在文档库中自动更新，因此在移动结束后，必须将更改列表提交到文档库中。在移动文件前，必须 check-in 文档库。

|  |  |
| --- | --- |
| [备注] | 备注 |
| 您必须先保存工程，然后再在 Originals 文件夹中移动源文件。 |

**在 Originals 目录内的文件夹之间移动文件的方法如下：**

1. 保存当前工程。
2. 执行以下操作之一：

   - 在菜单栏中，依次单击 **Project** > **File Manager**（工程 > 文件管理器）。
   - 按 **Shift+F1**。

   File Manager 将打开 。
3. 切换至 Source Files 选项卡。
4. 选择要移动的文件。
5. 右键点击选定项，然后从菜单中选择 **Move**（移动）。

   这时会打开 Browse For Folder（浏览文件夹）对话框。
6. 浏览文件夹结构并选择要移动其中文件的文件夹。

   |  |  |
   | --- | --- |
   | [备注] | 备注 |
   | 如果要创建新的文件夹，则请选择父文件夹，点击 **Make New Folder**（新建文件夹）按钮，然后为文件夹指定一个名称。 |
7. 打开 **OK** 以将文件移动到新文件夹。

   The Process Log dialog opens showing that a new copy of the file has been added to the specified folder using the branch command and the original file has been opened for delete.
8. 单击 **OK**（确定）关闭 Process Log（处理日志）对话框。
9. Select both entries in the list: the branch and deletion.
10. 右键点击选定项，并从菜单中选择 **Submit Change**。

    The Description dialog opens.
11. 输入有用的描述，然后点击 **OK**。

    此时 Process Log 将打开，显示两个待提交的操作已提交到文档库。
12. 点击 **OK** 以关闭 Process Log。

    文件于是放置于指定文件夹中了。

### Renaming files when using Perforce

您可以对工程中的文件进行重命名，但在此之前，应确保其它团队成员没有在使用该文件。如果您对已被其他人 check-out 的文件进行重命名，他们在尝试将更改提交到文档库时则会遇到问题。

当 Perforce 对文件重命名时，它将打开当前文件以待删除，并使用新名称创建该文件的完全副本。这些文件不会自动在文档库中更新，因此重命名结束后，必须将更改列表提交到文档库中。在重命名文件前，必须先 check-in 到文档库中。

|  |  |
| --- | --- |
| [注意] | 注意 |
| 勿对默认工作单元进行重命名，因为它们对工程至关重要。 |

**对工程中的文件进行重命名的方法是：**

1. 在菜单栏中，依次单击 **Project** > **File Manager**（工程 > 文件管理器）。

   File Manager 将打开 。
2. Right-click the Work Unit file you want to rename, and select **Rename** from the menu.

   The Rename File dialog opens.
3. In the **Name** field, type the new name for your file.
4. 单击 **OK**（确定）。

   The Process Log dialog opens showing that a copy of the file was created with the new name using the branch command and the old file was opened for delete.
5. 点击 **OK** 以关闭 Process Log。

   旧文件的状态设置为“Delete”，并且创建了一个状态设为“Branch”的新文件。
6. 选择新旧文件。
7. 右键点击并从菜单中选择 **Submit Changes**。

   The Description dialog opens.
8. 输入有关更改的有用描述，并点击 **OK**。

   Process Log 打开，其中显示原始文件已删除，并添加了一个重命名的新文件。
9. 点击 **OK** 以关闭 Process Log。
10. 点击 **Close** 以关闭 File Manager。

    The Project dialog opens prompting you to reload the latest version of the project because changes have been made externally to the project.
11. 点击 **Yes**。

    工程的最新版本于是加载进来了，并且文件也被重命名了。

### Deleting files from your project when using Perforce

当您不再需要工程中的某些文件时，可以删除它们。在 Perforce 中删除文件时，必须先打开文件以待删除，然后将更改列表提交到文档库。在删除文件前，应始终先保存工程，防止丢失您自上次保存以来所做的更改。

|  |  |
| --- | --- |
| [注意] | 注意 |
| 切勿删除默认工作单元，因为它们对工程至关重要。 |

**从工程中删除文件的方法是：**

1. 在菜单栏中，依次单击 **Project** > **File Manager**（工程 > 文件管理器）。

   File Manager 将打开 。
2. 选择您要删除的文件。
3. 右键点击选定的工程文件之一，然后从菜单中选择 **Mark for Delete**。

   此时将显示一条消息，提示您确认删除文件。
4. 点击 **Yes**。

   The Process Log dialog opens showing that the file(s) has been opened for delete.
5. 点击 **OK** 以关闭 Process Log。

   文件的状态设置为“delete”。
6. 点击 **Close** 以关闭 File Manager。

   The Project dialog opens prompting you to reload the latest version of the project since changes have been made externally to the project.
7. 点击 **Yes**。

   工程的最新版本于是加载进来了，并且文件也被删除了。

   此时，文件只是被添加到了更改列表中，并且已被标记为待删除。您还需要提交更改列表才能从文档库中删除文件。

### Saving your project when using Perforce

只要签出了修改的所有工程文件，保存工程时就不会出现任何问题。但是，若对没有签出的文件实施了更改，则 Wwise 将提示必须签出这些文件才能保存工程。

**保存工程的方法是：**

1. 执行以下操作之一：

   - 在菜单栏中，点击 **Project** > **Save**。
   - 按 **Ctrl+S**。

   Wwise 试图保存工程中的所有文件。若对没有签出的文件实施了更改，则将打开 Pending Source Control Operations（待处理版本控制操作）对话框。

   |  |  |
   | --- | --- |
   | [备注] | 备注 |
   | 若启用了工程设置 **Prompt for checkout on edit**，则只要修改没有签出的文件，也会马上打开 Pending Source Control Operations 对话框。请参阅 [“General 选项卡”一节](../../09-参考主题/01-工程/08-Project-Settings/01-General-选项卡.md "General 选项卡") 了解详细信息。 |
2. 选择 **Check out modified files** 选项以检出已经更改的文件，以便 Wwise 保存它们。
3. 单击 **OK**（确定）。

   Wwise check-out 必要的文件并保存工程。

---