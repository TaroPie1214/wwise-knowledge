# 针对不同的 Wwise 平台构建工程

|  |
| --- |
| Wwise SDK 2025.1.4 - Windows |

针对不同的 Wwise 平台构建工程

# 构建插件

`build` 命令将使用之前生成的解决方案，来编译插件并将二进制文件复制到 Wwise 安装目录（若工程文件夹中没有所述解决方案，请参阅 [使用 Premake 配置工程](effectplugin_tools_premakeconfig.html) 章节）。 该命令必须从工程文件夹内调用，并且需要一系列参数来完成相应的操作。下面是个典型的 build 命令：

python "%WWISEROOT%/Scripts/Build/Plugins/wp.py" build -c Release -x x64 -t vc160 Authoring

This will build the project in release mode (`-c` flag), targeting the architecture x64 (`-x` flag) and MSVC toolset vc160 (`-t` flag), for the platform Authoring on the current operating system. 如需详细了解相关参数的可能值，请查看 `build` 命令的帮助信息。

python "%WWISEROOT%/Scripts/Build/Plugins/wp.py" build -h

二进制文件会直接输出到 Wwise 安装目录中以供稍后测试：

- 对于声音引擎插件部分，会存放到 `%WWISEROOT%/SDK/{Platform}/{Config}/{bin,lib}` 下。
- 对于 Windows 上的设计工具插件部分，会存放到 `%WWISEROOT%/Authoring/x64/{Config}/bin/Plugins` 下。
- 对于 macOS 上的设计工具插件部分，会存放到 `%WWISEROOT%/Authoring/macosx_gmake/{Config}/bin/Plugins` 下。
- 对于 Linux 上的设计工具插件部分，会存放到 `%WWISEROOT%/Authoring/linux_gmake/{Config}/bin/Plugins` 下。
- 对于文档插件部分，会存放到 `%WWISEROOT%/Authoring/Data/Plugins/{PluginName}/Html` 下。

|  |  |
| --- | --- |
|  | **备注:** 有些平台会在执行 `build` 命令的过程中为多个工具链版本构建插件，包括为每个工程构建调用设置独有的环境变量。对于支持的各个平台，`%WWISEROOT%/Scripts/ToolchainSetup/{Platform}` 目录（如有）包含两个文件：   - `ToolchainVers.txt`：指定平台支持的一系列工具链版本 - `GetToolchainEnv.py`：决定要在构建过程中应用的环境变量，给定 `ToolchainVers.txt` 中的某个值作为参数   在必要时，还可在命令行上指定 `–toolchain-vers {file}` 或 `–toolchain-env-script {file}`，来在 wp.py 中执行构建命令时根据需要覆盖所述文件。在要使用自己的构建结构或独立于 Wwise SDK 为工具链发布插件时，有可能需要这样做。  wp.py 生成的工程还会基于定义的环境针对工程编译所对应的工具链版本自动调节构建输出文件夹。有关如何根据各个平台加以确定的详细信息，请参阅对应的“有关平台的特定信息”页面。 |

# 添加目标平台

在开发插件的过程中，随时都可以添加目标平台。为此，可使用 premake 和 build 来添加所需平台。至少要构建一个平台，对 `Authoring` 来说，很可能还要构建 `Documentation` 。藉此，可安装插件属性相关文档，并在选中属性时在 **Property** **Help** 面板中显示帮助信息。

比如，通过在命令行中运行以下代码，来添加 Windows\_vc160 和 Authoring 平台：

python "%WWISEROOT%/Scripts/Build/Plugins/wp.py" premake Windows\_vc160

python "%WWISEROOT%/Scripts/Build/Plugins/wp.py" premake Authoring

python "%WWISEROOT%/Scripts/Build/Plugins/wp.py" build Windows\_vc160 -c Release -x x64

python "%WWISEROOT%/Scripts/Build/Plugins/wp.py" build Authoring -c Release -x x64 -t vc160

python "%WWISEROOT%/Scripts/Build/Plugins/wp.py" build Documentation

# 使用挂钩执行构建后操作

在构建特定目标后，经常要执行各种自定义操作。This can be achieved by adding the `–build-hooks-file` flag to the `build` command and specifying a Python file. This file must be created by the User and is not part of the initial skeleton generated by the `new` command. 这里的示例展示了 post-build 挂钩文件所含的内容：

# build\_hooks.py

# 定义 postbuild 挂钩

# 此函数由插件开发工具在每次成功构建目标后调用

def postbuild(\*\*kwargs):

WWISE\_ROOT = kwargs.get("wwise\_root") # Wwise 安装根目录的绝对路径

PROJECT\_ROOT = kwargs.get("project\_root") # 插件根目录的绝对路径

platform = kwargs.get("platform") # # 所构建的平台的名称（Authoring、Windows\_vc140 等）

arch = kwargs.get("arch") # 所构建的基础架构（Win32\_vc140、x64\_vc140 等）

config = kwargs.get("config") # 所构建的配置（Debug、Profile、Release）

# 在此处插入代码

# ...

这里的示例会针对 Windows\_vc160 和 Authoring 平台调用 post-build 挂钩：

python "%WWISEROOT%/Scripts/Build/Plugins/wp.py" build Windows\_vc160 -c Release -x x64 --build-hooks-file=build\_hooks.py

python "%WWISEROOT%/Scripts/Build/Plugins/wp.py" build Authoring -c Release -x x64 -t vc160 --build-hooks-file=build\_hooks.py

python "%WWISEROOT%/Scripts/Build/Plugins/wp.py" build Documentation

**build\_hooks.py** 文件必须存放在插件的根目录下。

这里的示例会将 DLL 文件 (library.dll) 从插件目录复制到 Wwise 安装目录：

import os

import shutil

import sys

def postbuild(\*\*kwargs):

WWISE\_ROOT = kwargs.get("wwise\_root")

PROJECT\_ROOT = kwargs.get("project\_root")

platform = kwargs.get("platform")

arch = kwargs.get("arch")

config = kwargs.get("config")

# Build a multimap of destination folders => files to copy

platform\_files = {}

if platform == "Authoring\_Windows":

platform\_files["Authoring/x64/{}/bin/plugins".format(config)] = [

"Prebuilt/x64/{}/library.dll".format(config)

]

elif platform == "Windows\_vc160":

platform\_files["SDK/{}/{}/bin".format(arch, config)] = [

"Prebuilt/{}/{}/library.dll".format(arch, config)

]

# Copy all of the file to their destination

for dest, files in platform\_files.items():

dest = os.path.join(WWISE\_ROOT, dest)

for file in files:

file = os.path.join(PROJECT\_ROOT, file)

try:

shutil.copy(file, dest)

print("POSTBUILD HOOK: Copied {} to {}".format(file, dest))

except IOError:

sys.stderr.write("POSTBUILD HOOK: Failed to copy {} to {}\n".format(file, dest))

If you want to add unit tests to your plug-in project, see [Unit Testing Your Plug-in](effectplugin_tools_unittest.html).

Otherwise, the last step to perform, when the development of the plug-in is finished, is to package the project in a format ready to install by the Audiokinetic Launcher. 有关更多详细信息，请参阅 [将插件打包以便用在 Audiokinetic Launcher 中](effectplugin_tools_packaging.html) 章节。

Next section: [Unit Testing Your Plug-in](effectplugin_tools_unittest.html)