# 设计工具插件的后端

|  |
| --- |
| Wwise SDK 2025.1.4 - Windows |

设计工具插件的后端

要为插件创建后端，需创建通过 `AK::Wwise::Plugin::AudioPlugin` 获取的类。 此基类可为 Wwise 设计工具插件提供各种基本方法，包括用于将数据写入 SoundBank 的函数。

插件的主模型为 [Property Set](plugin_backend_model.html#wwiseplugin_propertyset) ，不过 [自定义数据](plugin_backend_model.html#wwiseplugin_complexproperty) 同样可由插件后端管理。

#include <[AK/Wwise/Plugin.h](_plugin_8h.html)>

class BackendSourcePlugin

: public [AK::Wwise::Plugin::AudioPlugin](class_a_k_1_1_wwise_1_1_plugin_1_1_v1_1_1_audio_plugin.html)

, public [AK::Wwise::Plugin::Source](class_a_k_1_1_wwise_1_1_plugin_1_1_v1_1_1_source.html)

{

public:

// AK::Wwise::Plugin::AudioPlugin

bool [GetBankParameters](class_a_k_1_1_wwise_1_1_plugin_1_1_v1_1_1_audio_plugin_ae59a3955718ed3bbde0521da21cd8539.html#ae59a3955718ed3bbde0521da21cd8539)(

const GUID& in\_guidPlatform,

[AK::Wwise::Plugin::DataWriter](class_a_k_1_1_wwise_1_1_plugin_1_1_v1_1_1_data_writer.html)& in\_dataWriter

) const override;

// AK::Wwise::Plugin::Source

bool [GetSourceDuration](class_a_k_1_1_wwise_1_1_plugin_1_1_v1_1_1_source_acecbec655a9c34630b5b5c8efb29fe1d.html#acecbec655a9c34630b5b5c8efb29fe1d)(

double& out\_dblMinDuration,

double& out\_dblMaxDuration

) const override;

};

[AK\_ADD\_PLUGIN\_CLASS\_TO\_CONTAINER](_plugin_info_generator_8h_ae72bc9efe38504b8f47686c01f5882f8.html#ae72bc9efe38504b8f47686c01f5882f8)(

MyPlugin, // Add to container "MyPlugin"

BackendSourcePlugin, // Class to add to the container

SoundEngineSourcePlugin // Sound engine plug-in to which this plug-in corresponds

);

# 生成声音包

您必须为插件编写代码，以便在需要的情况下将其当前设置存储到声音包中。 可以通过实现 `AK::Wwise::Plugin::AudioPlugin::GetBankParameters()` 方法来做到。

这些参数将作为数据块写入到 SoundBank 中。数据块将被直接从声音包加载到声音引擎插件的参数结构中。因此，在您写入参数时，必须保证其顺序与它们在声音引擎插件的参数结构中的声明顺序是一致的。更多信息请参阅 [参数节点接口的实现](soundengine_plugins.html#shared_parameter_interface) 。

例如，考虑以下参数结构：

// 此效果器的参数结构。

struct AkFXSrcSineParams

{

[AkReal32](_ak_numeral_types_8h_afc38459f26e2b23defe588026e886a98.html#afc38459f26e2b23defe588026e886a98) fFrequency; // 频率（单位：赫兹）。

[AkReal32](_ak_numeral_types_8h_afc38459f26e2b23defe588026e886a98.html#afc38459f26e2b23defe588026e886a98) fGain; // 增益（单位：dBFS）。

[AkReal32](_ak_numeral_types_8h_afc38459f26e2b23defe588026e886a98.html#afc38459f26e2b23defe588026e886a98) fDuration; // 持续时间（仅当为有限值时才有效）。

};

以下 `AK::Wwise::Plugin::AudioPlugin::GetBankParameters()` 的实现将获取每个属性的当前值，然后使用适当方法将值写入，其中 `AK::Wwise::Plugin::DataWriter` 对象作为接收的参数。这些操作按照参数结构中各成员的定义顺序执行。

bool MySourcePlugin::GetBankParameters(

const GUID& in\_guidPlatform,

[AK::Wwise::Plugin::DataWriter](class_a_k_1_1_wwise_1_1_plugin_1_1_v1_1_1_data_writer.html)& in\_dataWriter) const

{

bool result = true;

result &= in\_dataWriter.[WriteReal32](class_a_k_1_1_wwise_1_1_plugin_1_1_v1_1_1_data_writer_a8d9b58e2ecba7f95721d4b89b7f9630f.html#a8d9b58e2ecba7f95721d4b89b7f9630f)(m\_propertySet->GetReal32(in\_guidPlatform, "Frequency"));

result &= in\_dataWriter.[WriteReal32](class_a_k_1_1_wwise_1_1_plugin_1_1_v1_1_1_data_writer_a8d9b58e2ecba7f95721d4b89b7f9630f.html#a8d9b58e2ecba7f95721d4b89b7f9630f)(m\_propertySet->GetReal32(in\_guidPlatform, "Gain"));

result &= in\_dataWriter.[WriteReal32](class_a_k_1_1_wwise_1_1_plugin_1_1_v1_1_1_data_writer_a8d9b58e2ecba7f95721d4b89b7f9630f.html#a8d9b58e2ecba7f95721d4b89b7f9630f)(m\_propertySet->GetReal32(in\_guidPlatform, "Duration"));

return result;

}

|  |  |
| --- | --- |
|  | **备注:** 若要获取属性的当前值，请使用 `AK::Wwise::Plugin::PropertySet` 提供的获取函数。 要求的类型必须与 XML 中指定的类型完全匹配。 |

关于写入不同数据类型的可用方法，更多信息请参阅 [AK::Wwise::Plugin::DataWriter](namespace_a_k_1_1_wwise_1_1_plugin_a32526a23215a4452f561220b527e12f8.html#a32526a23215a4452f561220b527e12f8) 。

# 管理授权

在生成 SoundBank 的过程中，Wwise 会查询插件通过 `AK::Wwise::Plugin::License` 接口实现的授权状态。插件可实现 `AK::Wwise::Plugin::License::GetLicenseStatus` ，并返回 `AK::Wwise::Plugin::LicenseStatus` 中的某个枚举值。另外，插件还可返回一条信息及信息的严重性级别，以便显示在 SoundBank 生成日志中。

通过返回 `LicenseStatus_Unlicensed` 或 `LicenseStatus_Expired，可以避免将相应插件包含在` SoundBank 中。

插件可以应用自有的授权验证方案。请注意，切勿在此函数中同步查询服务器。该函数需要立即返回答复。

若通过 Audiokinetic 注册插件，则可使用 Wwise 的授权系统。 使用以下实现代码查询 Wwise Project License 中的授权状态：

[AK::Wwise::Plugin::LicenseStatus](namespace_a_k_1_1_wwise_1_1_plugin_a74c80204b884826c56e3d208bd3d1df4.html#a74c80204b884826c56e3d208bd3d1df4) MyPlugin::GetLicenseStatus(

const GUID& in\_guidPlatform,

[AK::Wwise::Plugin::Severity](namespace_a_k_1_1_wwise_1_1_plugin_a9c61cf9f6b1cb69de3722982150b67ed.html#a9c61cf9f6b1cb69de3722982150b67ed)& out\_eSeverity,

char\* out\_pszMessage,

unsigned int in\_uiBufferSize)

{

[AK::Wwise::Plugin::LicenseType](namespace_a_k_1_1_wwise_1_1_plugin_a58ce97270e1033ca4f52b145c8fd21eb.html#a58ce97270e1033ca4f52b145c8fd21eb) eType;

[AK::Wwise::Plugin::LicenseStatus](namespace_a_k_1_1_wwise_1_1_plugin_a74c80204b884826c56e3d208bd3d1df4.html#a74c80204b884826c56e3d208bd3d1df4) eStatus;

uint32\_t uDaysToExpiry;

m\_host.GetLicenseStatus(in\_guidPlatform, eType, eStatus, uDaysToExpiry);

return eStatus;

}

[Plugin.h](_plugin_8h.html)

Wwise Authoring Plug-ins - Main include file.

[AK.Wwise::Plugin::V1::DataWriter](class_a_k_1_1_wwise_1_1_plugin_1_1_v1_1_1_data_writer.html)

Interface used to write data during sound bank generation.

**Definition:** [HostDataWriter.h:245](_host_data_writer_8h_source.html#l00244)

[AK.Wwise::Plugin::V1::DataWriter::WriteReal32](class_a_k_1_1_wwise_1_1_plugin_1_1_v1_1_1_data_writer_a8d9b58e2ecba7f95721d4b89b7f9630f.html#a8d9b58e2ecba7f95721d4b89b7f9630f)

bool WriteReal32(float in\_value)

Writes a 32-bit, single-precision floating point value.

**Definition:** [HostDataWriter.h:427](_host_data_writer_8h_source.html#l00427)

[AkReal32](_ak_numeral_types_8h_afc38459f26e2b23defe588026e886a98.html#afc38459f26e2b23defe588026e886a98)

float AkReal32

32-bit floating point

**Definition:** [AkNumeralTypes.h:43](_ak_numeral_types_8h_source.html#l00043)

[AK.Wwise::Plugin::LicenseType](namespace_a_k_1_1_wwise_1_1_plugin_a58ce97270e1033ca4f52b145c8fd21eb.html#a58ce97270e1033ca4f52b145c8fd21eb)

LicenseType

License type.

**Definition:** [PluginDef.h:60](_plugin_def_8h_source.html#l00059)

[AK.Wwise::Plugin::V1::Source](class_a_k_1_1_wwise_1_1_plugin_1_1_v1_1_1_source.html)

Wwise API for general Audio Plug-in's backend.

**Definition:** [Source.h:91](_source_8h_source.html#l00090)

[AK.Wwise::Plugin::V1::AudioPlugin](class_a_k_1_1_wwise_1_1_plugin_1_1_v1_1_1_audio_plugin.html)

Wwise API for general Audio Plug-in's backend.

**Definition:** [AudioPlugin.h:133](_audio_plugin_8h_source.html#l00130)

[AK.Wwise::Plugin::Severity](namespace_a_k_1_1_wwise_1_1_plugin_a9c61cf9f6b1cb69de3722982150b67ed.html#a9c61cf9f6b1cb69de3722982150b67ed)

Severity

Log message severity.

**Definition:** [PluginDef.h:110](_plugin_def_8h_source.html#l00109)

[AK\_ADD\_PLUGIN\_CLASS\_TO\_CONTAINER](_plugin_info_generator_8h_ae72bc9efe38504b8f47686c01f5882f8.html#ae72bc9efe38504b8f47686c01f5882f8)

#define AK\_ADD\_PLUGIN\_CLASS\_TO\_CONTAINER(ContainerName, WwiseClassName, AudioEngineRegisteredName)

(C++) Adds a Wwise Authoring plug-in and a Sound Engine plug-in to a plug-in container.

**Definition:** [PluginInfoGenerator.h:882](_plugin_info_generator_8h_source.html#l00882)

[AK.Wwise::Plugin::V1::Source::GetSourceDuration](class_a_k_1_1_wwise_1_1_plugin_1_1_v1_1_1_source_acecbec655a9c34630b5b5c8efb29fe1d.html#acecbec655a9c34630b5b5c8efb29fe1d)

virtual bool GetSourceDuration(double &out\_dblMinDuration, double &out\_dblMaxDuration) const =0

Return the minimum and maximum duration, in seconds.

[AK.Wwise::Plugin::V1::AudioPlugin::GetBankParameters](class_a_k_1_1_wwise_1_1_plugin_1_1_v1_1_1_audio_plugin_ae59a3955718ed3bbde0521da21cd8539.html#ae59a3955718ed3bbde0521da21cd8539)

virtual bool GetBankParameters(const GUID &in\_guidPlatform, DataWriter &in\_dataWriter) const

Obtains parameters that will be written to a bank.

**Definition:** [AudioPlugin.h:228](_audio_plugin_8h_source.html#l00228)

[AK.Wwise::Plugin::LicenseStatus](namespace_a_k_1_1_wwise_1_1_plugin_a74c80204b884826c56e3d208bd3d1df4.html#a74c80204b884826c56e3d208bd3d1df4)

LicenseStatus

License status.

**Definition:** [PluginDef.h:68](_plugin_def_8h_source.html#l00067)