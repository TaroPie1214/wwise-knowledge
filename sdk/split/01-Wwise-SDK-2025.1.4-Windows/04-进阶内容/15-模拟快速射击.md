# 模拟快速射击

|  |
| --- |
| Wwise SDK 2025.1.4 - Windows |

模拟快速射击

在制作的工程包含射速很快的枪支（如机关枪）时，有时很难让子弹声音与射击动作精确同步。因为 Wwise Event 在音频线程上是异步处理的，所以若在循环容器上应用精确到采样点的过渡，中断动作和枪声终止之间可能会出现少许延迟。

为了对快速射击实现精确到采样点的触发速率，建议使用 MIDI 来触发每个子弹声音。我们可以借助 `PostMIDIOnEvent` 来在给定音频帧内实施精确的偏置（以样本为单位）并以此提高精度。

基于 MIDI 的解决方案要求：

- 选用以下选项来管理音频渲染：
  - 使用全局回调在回调内发送子弹 Event。通过 [Ak::SoundEngine::RegisterGlobalCallback](https://www.audiokinetic.com/library/edge/?source=SDK&id=namespace_a_k_1_1_sound_engine_ade293d3ed101fe494ead6dffb1c682fb.html#ade293d3ed101fe494ead6dffb1c682fb) 注册全局回调。
  - 自行管理对 `AK::SoundEngine::RenderAudio()` 的调用，来在所需的帧上应用 Play 和 Stop 动作。有关详细信息，请参阅 [优化 CPU 用量](goingfurther_eventmgrthread.html) 中的“音频渲染线程”章节。
- Integration Demo 包含使用节拍器声音的示例 MIDI 实现。您可以将同样的原理应用于快速射击场景。可在  `<WwiseInstallationFolder>\SDK\samples\IntegrationDemo\DemoPages\DemoMIDIMetronome.cpp` 找到相关文件，并在 [Integration Demo 示例](soundengine_integration_samplecode.html) 找到对应文档（参见 MIDI API 章节）。
- 相关 API 为 [PostMIDIOnEvent()](https://www.audiokinetic.com/library/edge/?source=SDK&id=namespace_a_k_1_1_sound_engine_ab24b5dc8bd4d1adbdc6aa5c98d94d946.html) 和 [StopMIDIOnEvent()](https://www.audiokinetic.com/library/edge/?source=SDK&id=namespace_a_k_1_1_sound_engine_acce4adb3c2bbd018ef375c85379949e3.html)。

# Limitations

There is a limitation when using MIDI-triggered events in conjunction with Wwise Spatial Audio. MIDI events are triggered internally by the sound engine and might occur between frame boundaries. However, the acoustics simulation is updated before the audio frame begins. If such an event occurs, it might not be possible for the acoustics engine to perform an update in time, which can cause the first frame of audio to be rendered without acoustic path information, resulting in audible glitches. This behavior happens when the first sound played on a Game Object is a sound triggered by MIDI, and the acoustics engine has not yet calculated the sound propagation paths for that Game Object.

As a workaround, play a separate sound on the same Game Object to force the acoustics engine to calculate the sound propagation paths. The **Enable Diffraction and Transmission** option must be selected for the separate sound. For a sustained event like rapid gunfire, the separate sound (for example, a loop of silence) must be played for the duration of the rapid gunfire event to ensure the paths are calculated when a MIDI event occurs.