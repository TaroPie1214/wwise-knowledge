# 集成二路输出

|  |
| --- |
| Wwise SDK 2025.1.4 - Windows |

集成二路输出

在 Wwise 中，二路输出（Secondary Output）指定常规 TV 音频输出之外的任何物理音频终端。最常见的二路输出包括耳机、游戏控制器扬声器和游戏控制器的触觉反馈。有关触觉反馈集成的详细信息，请参阅 [集成 Wwise Motion](integrating_elements_motion.html) 章节。本主题着重介绍音频输出（耳机和控制器扬声器）。

您可以使用二路输出为各个输出单独定义混音，确保不会影响主扬声器/TV 混音。常规混音相关 Wwise 功能对二路输出来说同样适用。唯一的区别在于输出指向控制器而非扬声器/TV。

# 总线通路

在设计端，需要创建新的主总线，以便为 Audio Device 定义不同的混音。然后，更改应用于新总线的 Audio Device ShareSet 属性，使其指向不同的设备。注意，若要使用第三方创建的 Audio Device 插件，则可能需要先创建对应插件类型的 Audio Device ShareSet。然后，才能将声音正常输出至新总线或其子总线。有关 Wwise 所支持 Audio Device 的信息，请参阅[内置音频设备](https://www.audiokinetic.com/library/edge/?source=Help&id=builtin_audio_devices)。

对于仅与一个二路输出绑定的声音，最好直接设置 Output Bus。这样的声音例子有：玩家发起的枪击、网球拍重击、PDA 音效、游戏反馈等。不过，您可以将 User Send 或 Game Send 应用于其他总线层级结构内的 Auxiliary Bus。若要将同一声音同时发送至多个输出和 TV（比如使用间谍相机或广播），则最好采用这一方法。

使用同一声源可在多个控制器和 TV 上同时播放同一声音。在设计方面，无需知道有多少玩家可能在玩此游戏。此总线层级结构将用作模版在为游戏中注册的各个输出布线时使用。因此各个输出上可能会施加不同的混音和效果，具体取决于播放的声源、游戏对象上活跃的 RTPC 和 Swtich（切换开关）值。请参见下面示例部分中有关这方面的示例。

## 关于输出同步的说明

在许多设备（例如 TV 和游戏控制器）上输出同一音频时，您也许会发现设备之间存在延迟。这是声音信号路径的硬件差异造成的，因此无法避免。在控制器方面，此信号可能必须通过无线信道传输，无线信道造成的延迟可能不同于有线控制器。对于 TV，信号离开主机后，将进入接收器或 TV，其处理器会造成一定程度的延时。由于各个系统的 AV 设置造成的延时各有不同，因此对分别传输到扬声器/TV 和游戏控制器的声音而言，无法保证两者之间的同步。在设计声音时，可能需要考虑这一限制。

# 为多个输出设置设备、听者和游戏对象

若存在多个相同类型的输出（如游戏控制器扬声器），则必须对各个设备加以区分。之所以使用 `Listener/GameObject` 这一常规概念，是因为方便实现特定的听者/发声体通路。请参阅 [了解听者](concept_listeners.html) 了解更多信息。游戏程序员要负责使用 `AK::SoundEngine::AddOutput` 将输出设备与听者关联起来。程序员必须使用 `AK::SoundEngine::SetActiveListeners` 来设置听者和游戏对象之间的关系。记住，若希望多个设备同时播放此声音，则可指定多个听者。

|  |  |
| --- | --- |
|  | **备注:** 假如只有某一特定类型的输出（如 System、DVR），则无需设置多个听者。此时，Wwise 可使用工程中指定的通路。若为单人游戏，则对玩家专用输出（如 Game Controller Speaker 和 Communication）来说也是如此。也就是说，游戏中将只有一个激活的控制器。有关听者的详细信息，请参阅“ [集成 Listener](soundengine_listeners.html) ”。 |

|  |  |
| --- | --- |
|  | **备注:** 在确定玩家与设备的关系时，只要系统连接或断开游戏控制器，游戏代码就要负责调用 `AK::SoundEngine::AddOutput` 和 `AK::SoundEngine::RemoveOutput`。Wwise 可自动识别设备与听者之间的关系，从而确定玩家与设备的关系。系统设备（如主输出和 DVR）将由 Wwise 自动处理。 |

# 示例

以下示例专为 PS4 编写，但可应用于所有其他平台。请检查 `AK::SoundEngine::AddOutput` 函数的文档。如需查看多输出管理的工作示例，请参阅“[Integration Demo 示例](soundengine_integration_samplecode.html) ”中的 DemoMotion 页面（多人设置）和 BGMDemo 页面（DVR/BGM 管理）。

|  |  |
| --- | --- |
|  | **备注:** 为了方便阅读，这些示例省略了函数调用之前所需的 `AK::SoundEngine`。 |

**用于获取 UserID 的代码（仅适用于 PS4 示例。对于其他平台，请参阅 [默认 Wwise Audio Device](default_audio_devices.html) 章节）：**

SceUserServiceLoginUserIdList list;

sceUserServiceGetLoginUserIdList(&list);

**一个游戏控制器输出上的声音：**

// 添加二路输出，连接至扬声器终端，用于玩家 0。

[AkOutputSettings](struct_ak_output_settings.html) outputSettings("Game Controller Speaker", list.userId[0] /\*Player ID (first player)\*/);

[AddOutput](namespace_a_k_1_1_sound_engine_a15ab79f954a307902f529d8ccde8ad48.html#a15ab79f954a307902f529d8ccde8ad48)(outputSettings);

// 播放一个事件。在 Wwise 工程中，必须将此声音连通至某条主总线，该总线的输出设备要设为 “Game Controller Speaker”（或其子设备总线）。

[PostEvent](namespace_a_k_1_1_sound_engine_a41e9ef8d42951871fe4a8ae58a29a68e.html#a41e9ef8d42951871fe4a8ae58a29a68e)("Play\_Pow", MY\_GAME\_OBJECT);

**在两个不同控制器上播放同一声音：**

// 添加二路输出，连接至扬声器输出，用于玩家 0，与听者 #1 关联。

[AkOutputSettings](struct_ak_output_settings.html) outputSettings1("Game Controller Speaker", list.userId[0] /\*Player ID (first player)\*/);

[AddOutput](namespace_a_k_1_1_sound_engine_a15ab79f954a307902f529d8ccde8ad48.html#a15ab79f954a307902f529d8ccde8ad48)(outputSettings1, NULL, listenerArray1, 1);

// 添加二路输出，连接至扬声器输出，用于玩家 1，与听者 #2 关联。

[AkOutputSettings](struct_ak_output_settings.html) outputSettings2("Game Controller Speaker", list.userId[1] /\*Player ID (first player)\*/);

[AddOutput](namespace_a_k_1_1_sound_engine_a15ab79f954a307902f529d8ccde8ad48.html#a15ab79f954a307902f529d8ccde8ad48)(outputSettings2, NULL, listenerArray2, 1);

// 设置将声音发送给听者 1（玩家 0）和 2（玩家 1）的游戏对象。

SetActiveListeners(EXISTING\_GAME\_OBJECT, listenerArrayBoth, 2);

// 播放一个事件。在 Wwise 工程中，必须将此声音连通至某条主总线，该总线的输出设备要设为 “Game Controller Speaker”（或其子设备总线）。

[PostEvent](namespace_a_k_1_1_sound_engine_a41e9ef8d42951871fe4a8ae58a29a68e.html#a41e9ef8d42951871fe4a8ae58a29a68e)("Play\_Pow", EXISTING\_GAME\_OBJECT);

**在两个不同控制器上播放不同声音：**

// 添加二路输出，连接至扬声器输出，用于玩家 0，与听者 #1 关联。

[AkOutputSettings](struct_ak_output_settings.html) outputSettings1("Game Controller Speaker", list.userId[0] /\*Player ID (first player)\*/);

[AddOutput](namespace_a_k_1_1_sound_engine_a15ab79f954a307902f529d8ccde8ad48.html#a15ab79f954a307902f529d8ccde8ad48)(outputSettings1, NULL, listenerArray1, 1);

[AkOutputSettings](struct_ak_output_settings.html) outputSettings2("Game Controller Speaker", list.userId[1] /\*Player ID (first player)\*/);

[AddOutput](namespace_a_k_1_1_sound_engine_a15ab79f954a307902f529d8ccde8ad48.html#a15ab79f954a307902f529d8ccde8ad48)(outputSettings2, NULL, listenerArray2, 1);

// 设置将声音发送到相应听者的游戏对象

[RegisterGameObj](namespace_a_k_1_1_sound_engine_a895ed0f83a0dea8fc284491c0ee0152c.html#a895ed0f83a0dea8fc284491c0ee0152c)(MY\_GAME\_OBJECT1, listenerArray1, 1);

SetActiveListeners(MY\_GAME\_OBJECT1, listenerArray1, 1);

[RegisterGameObj](namespace_a_k_1_1_sound_engine_a895ed0f83a0dea8fc284491c0ee0152c.html#a895ed0f83a0dea8fc284491c0ee0152c)(MY\_GAME\_OBJECT2, listenerArray2, 1);

SetActiveListeners(MY\_GAME\_OBJECT2, listenerArray2, 1);

// 播放一个事件。在 Wwise 工程中，必须将此声音连通至某条主总线，该总线的输出设备要设为 “Game Controller Speaker”（或其子设备总线）。

[PostEvent](namespace_a_k_1_1_sound_engine_a41e9ef8d42951871fe4a8ae58a29a68e.html#a41e9ef8d42951871fe4a8ae58a29a68e)("Play\_Pow", MY\_GAME\_OBJECT1);

[PostEvent](namespace_a_k_1_1_sound_engine_a41e9ef8d42951871fe4a8ae58a29a68e.html#a41e9ef8d42951871fe4a8ae58a29a68e)("Play\_Pif", MY\_GAME\_OBJECT2);

**在游戏控制器输出和 TV 上播放同一声音：**

// 添加二路输出，连接至扬声器输出，用于玩家 0，与听者 #1 关联。

[AkOutputSettings](struct_ak_output_settings.html) outputSettings1("Game Controller Speaker", list.userId[0] /\*Player ID (first player)\*/);

[AddOutput](namespace_a_k_1_1_sound_engine_a15ab79f954a307902f529d8ccde8ad48.html#a15ab79f954a307902f529d8ccde8ad48)(outputSettings1, NULL, listenerArray1, 1);

// 设置将声音发送到听者 0（TV）和 1（对于玩家 0，发送到控制器）的游戏对象。

[AkGameObjectID](_ak_typedefs_8h_a352a1eb6955fa208062e40a9ccdd2560.html#a352a1eb6955fa208062e40a9ccdd2560) [] listenerArrayWithDefault = {MY\_MAIN\_LISTENER, MY\_LISTENER1}; // 通常，会将 MY\_MAIN\_LISTENER 用作听者（具体由 AK::SoundEngine::SetDefaultListeners 定义）。

[RegisterGameObj](namespace_a_k_1_1_sound_engine_a895ed0f83a0dea8fc284491c0ee0152c.html#a895ed0f83a0dea8fc284491c0ee0152c)(MY\_GAME\_OBJECT);

SetActiveListeners(MY\_GAME\_OBJECT, listenerArrayWithDefault, 2);

// 播放一个事件。

// 在 Wwise 工程中，必须将此声音连通至某条主总线，该总线的输出设备要设为 “Game Controller Speaker”（或其子设备总线）。

// Also, this sound must have an Auxiliary send routed to the Main Audio Bus.

[PostEvent](namespace_a_k_1_1_sound_engine_a41e9ef8d42951871fe4a8ae58a29a68e.html#a41e9ef8d42951871fe4a8ae58a29a68e)("Play\_Pow", MY\_GAME\_OBJECT);

以下例子阐述了如何在 Windows 上添加二路输出（即耳机）：

|  |  |
| --- | --- |
|  | **备注:** 在 Windows 上，所有设备均为 System 设备。之所以添加设备，是为了区分这些设备（详见“ [为多个输出设置设备、听者和游戏对象](integrating_secondary_outputs.html#secondary_output_game_side) ”）。添加二路输出，连接至之前所发现设备，与听者 #1 关联。所以，我们需要不同的听者。 |

// 将搜索名称中包含 Headphones 的设备。

uDeviceID = [AK::GetDeviceIDFromName](namespace_a_k_a8609f19bc85d9ea8266c2fdd79ac5084.html#a8609f19bc85d9ea8266c2fdd79ac5084)("Headphones");

// 添加二路输出，连接至之前所发现设备，与听者 #1 关联。

[AkOutputSettings](struct_ak_output_settings.html) outputSettings1("System", uDeviceID);

[AddOutput](namespace_a_k_1_1_sound_engine_a15ab79f954a307902f529d8ccde8ad48.html#a15ab79f954a307902f529d8ccde8ad48)(uoutputSettings1, NULL, listenerArray1, 1);

// 注册仅与 listener1 关联的游戏对象。

[RegisterGameObj](namespace_a_k_1_1_sound_engine_a895ed0f83a0dea8fc284491c0ee0152c.html#a895ed0f83a0dea8fc284491c0ee0152c)(MY\_GAME\_OBJECT, listenerArray1, 1);

// 播放一个事件。在 Wwise 工程中，必须将此声音连通至某条主总线，该总线的输出设备要设为 “System”（或其子设备总线）。

[PostEvent](namespace_a_k_1_1_sound_engine_a41e9ef8d42951871fe4a8ae58a29a68e.html#a41e9ef8d42951871fe4a8ae58a29a68e)("Play\_Pow", MY\_GAME\_OBJECT);

参见
:   - [默认 Wwise Audio Device](default_audio_devices.html)
    - [Targeting Specific System Devices](default_audio_devices.html#obtaining_device_id)

[AkGameObjectID](_ak_typedefs_8h_a352a1eb6955fa208062e40a9ccdd2560.html#a352a1eb6955fa208062e40a9ccdd2560)

AkUInt64 AkGameObjectID

Game object ID

**Definition:** [AkTypedefs.h:39](_ak_typedefs_8h_source.html#l00039)

[AK::SoundEngine::RegisterGameObj](namespace_a_k_1_1_sound_engine_a895ed0f83a0dea8fc284491c0ee0152c.html#a895ed0f83a0dea8fc284491c0ee0152c)

AKSOUNDENGINE\_API AKRESULT RegisterGameObj(AkGameObjectID in\_gameObjectID)

[AkOutputSettings](struct_ak_output_settings.html)

Platform-independent initialization settings of output devices.

**Definition:** [AkSoundEngineTypes.h:219](_ak_sound_engine_types_8h_source.html#l00218)

[AK::SoundEngine::AddOutput](namespace_a_k_1_1_sound_engine_a15ab79f954a307902f529d8ccde8ad48.html#a15ab79f954a307902f529d8ccde8ad48)

AKSOUNDENGINE\_API AKRESULT AddOutput(const AkOutputSettings &in\_Settings, AkOutputDeviceID \*out\_pDeviceID=NULL, const AkGameObjectID \*in\_pListenerIDs=NULL, AkUInt32 in\_uNumListeners=0)

[AK::GetDeviceIDFromName](namespace_a_k_a8609f19bc85d9ea8266c2fdd79ac5084.html#a8609f19bc85d9ea8266c2fdd79ac5084)

AKSOUNDENGINE\_API AkUInt32 GetDeviceIDFromName(wchar\_t \*in\_szToken)

[AK::SoundEngine::PostEvent](namespace_a_k_1_1_sound_engine_a41e9ef8d42951871fe4a8ae58a29a68e.html#a41e9ef8d42951871fe4a8ae58a29a68e)

AKSOUNDENGINE\_API AkPlayingID PostEvent(AkUniqueID in\_eventID, AkGameObjectID in\_gameObjectID, AkUInt32 in\_uFlags=0, AkCallbackFunc in\_pfnCallback=NULL, void \*in\_pCookie=NULL, AkUInt32 in\_cExternals=0, AkExternalSourceInfo \*in\_pExternalSources=NULL, AkPlayingID in\_PlayingID=AK\_INVALID\_PLAYING\_ID)