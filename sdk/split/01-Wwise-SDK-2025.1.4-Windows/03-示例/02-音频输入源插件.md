# 音频输入源插件

|  |
| --- |
| Wwise SDK 2025.1.4 - Windows |

音频输入源插件

# 关于此插件

此插件可让声音设计师使用来自外部源（例如网络流媒体或连接到 PC 或游戏机的话筒）的音频。

# 集成插件

除正常的插件初始化（请参见 [集成详情——插件](soundengine_integration_plugins.html) ），集成音频输入插件需要游戏提供 Wwise 工程中各种插件所使用的输入音频数据。这通过 [AkAudioInputSourceFactory.h](_ak_audio_input_source_factory_8h.html) 中暴露的回调机制来执行：

- 首先，游戏调用 [SetAudioInputCallbacks()](_ak_audio_input_plugin_8h_a8af9a8fca59e66e75f68b987e3f48db7.html#a8af9a8fca59e66e75f68b987e3f48db7 "This function should be called at the same place the AudioInput plug-in is being registered.") 来设置必需的 [AkAudioInputPluginExecuteCallbackFunc](_ak_audio_input_plugin_8h_a27b5a1a19c611de4eb85beb4e5fbb698.html#a27b5a1a19c611de4eb85beb4e5fbb698) ，每当音频输入端需要更多音频数据时都会调用此函数。
  - 若音频数据不是 32 位浮点值的单声道播放流，则须设置 [AkAudioInputPluginGetFormatCallbackFunc](_ak_audio_input_plugin_8h_aad871e20a8b120f2b436d22157ac7187.html#aad871e20a8b120f2b436d22157ac7187) 。此回调仅接受以下格式的音频数据（16 帧缓冲区按如下所示存储左右声道）：

    - 交错式 16 位整数（也叫 *2D 整数*）

      ![](../../../images/dgm_interleaved_audio_format.png)
    - 非交错式 32 位浮点数

      ![](../../../images/dgm_non_interleaved_audio_format.png)

    [AkAudioInputPluginGetFormatCallbackFunc](_ak_audio_input_plugin_8h_aad871e20a8b120f2b436d22157ac7187.html#aad871e20a8b120f2b436d22157ac7187) uses [AkAudioFormat](struct_ak_audio_format.html) which can be populated as shown in the example below. [AkAudioFormat](struct_ak_audio_format.html) consists of audio data format specifications and channel configuration [AkChannelConfig](struct_ak_channel_config.html).

    [AkChannelConfig](struct_ak_channel_config.html) 可通过以下所述调用进行设置： AkChannelConfig.SetAnonymous(...)、AkChannelConfig.SetStandard(...) 或 AkChannelConfig.SetAmbisonic(...)

    ChannelMask：对 channelmask 没有限制。支持标准和自定义 channelmask。

    Interleaved format (`AK_INTERLEAVED`) only supports `AK_INT`, and non-interleaved format (`AK_NONINTERLEAVED`) only supports `AK_FLOAT`.

[AkAudioFormat](struct_ak_audio_format.html) audioFormat;

[AkChannelConfig](struct_ak_channel_config.html) audioChConfig;

audioChConfig.[SetStandard](struct_ak_channel_config_a4c0f4b3d39608a10c9b330c1ef8281a7.html#a4c0f4b3d39608a10c9b330c1ef8281a7)(0);

audioFormat.[SetAll](struct_ak_audio_format_a9faddafaebebeb550993315c8f610aea.html#a9faddafaebebeb550993315c8f610aea)(

48000, // 采样率

audioChConfig, // \ref AkChannelConfig

16, // 位/样本

2, // 2 字节/样本

[AK\_INT](_ak_common_defs_8h_a27e63de612e818dbe8b87e583bc175e7.html#a27e63de612e818dbe8b87e583bc175e7), // 馈送整数（有符号）

[AK\_INTERLEAVED](_ak_common_defs_8h_a7fa3ccbf7577c429ea9612d9528350b8.html#a7fa3ccbf7577c429ea9612d9528350b8)

);

- 然后游戏用 PostEvent 启动音频输入插件。
- 一旦开始播放，声音引擎将调用 [AkAudioInputPluginGetFormatCallbackFunc](_ak_audio_input_plugin_8h_aad871e20a8b120f2b436d22157ac7187.html#aad871e20a8b120f2b436d22157ac7187) ，然后在每个音频帧调用 [AkAudioInputPluginExecuteCallbackFunc](_ak_audio_input_plugin_8h_a27b5a1a19c611de4eb85beb4e5fbb698.html#a27b5a1a19c611de4eb85beb4e5fbb698) ，直至插件完成执行（通过停止操作或对 io\_pBufferOut->eState 执行回调设置 [AK\_NoMoreData](_ak_enums_8h_a64f7d1f79613cc4dcc49a4efba6caa63.html#a64f7d1f79613cc4dcc49a4efba6caa63a94ba10d374d31161770fc490e0245802) ）。

[Microphone/AudioInput Demo](soundengine_integration_samplecode.html#integrationdemo_demos_micro) 演示中演示了一个非常简单的集成操作，它使用话筒作为输入设备。在 Integration Demo Wwise 工程中，被命名为 Microphone 的 Sound Voice（语音）使用音频输入插件作为来源。

|  |  |
| --- | --- |
|  | **备注:** 在 Wwise 中，音频输入插件收到来自 PC 话筒输入的音频。如果没有连接话筒，则不会出声。 |

[AkChannelConfig](struct_ak_channel_config.html)

**Definition:** [AkSpeakerConfig.h:436](_ak_speaker_config_8h_source.html#l00435)

[AkChannelConfig::SetStandard](struct_ak_channel_config_a4c0f4b3d39608a10c9b330c1ef8281a7.html#a4c0f4b3d39608a10c9b330c1ef8281a7)

AkForceInline void SetStandard(AkUInt32 in\_uChannelMask)

Set channel config as a standard configuration specified with given channel mask.

**Definition:** [AkSpeakerConfig.h:511](_ak_speaker_config_8h_source.html#l00511)

[AK\_INT](_ak_common_defs_8h_a27e63de612e818dbe8b87e583bc175e7.html#a27e63de612e818dbe8b87e583bc175e7)

const AkDataTypeID AK\_INT

Integer data type (uchar, short, and so on)

**Definition:** [AkCommonDefs.h:48](_ak_common_defs_8h_source.html#l00048)

[AkAudioFormat](struct_ak_audio_format.html)

Defines the parameters of an audio buffer format.

**Definition:** [AkCommonDefs.h:61](_ak_common_defs_8h_source.html#l00060)

[AK\_INTERLEAVED](_ak_common_defs_8h_a7fa3ccbf7577c429ea9612d9528350b8.html#a7fa3ccbf7577c429ea9612d9528350b8)

const AkDataInterleaveID AK\_INTERLEAVED

Interleaved data

**Definition:** [AkCommonDefs.h:51](_ak_common_defs_8h_source.html#l00051)

[AkAudioFormat::SetAll](struct_ak_audio_format_a9faddafaebebeb550993315c8f610aea.html#a9faddafaebebeb550993315c8f610aea)

void SetAll(AkUInt32 in\_uSampleRate, AkChannelConfig in\_channelConfig, AkUInt32 in\_uBitsPerSample, AkUInt32 in\_uBlockAlign, AkUInt32 in\_uTypeID, AkUInt32 in\_uInterleaveID)

**Definition:** [AkCommonDefs.h:124](_ak_common_defs_8h_source.html#l00124)