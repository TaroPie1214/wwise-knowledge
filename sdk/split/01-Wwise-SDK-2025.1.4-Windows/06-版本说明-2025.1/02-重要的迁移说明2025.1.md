# 重要的迁移说明2025.1

|  |
| --- |
| Wwise SDK 2025.1.4 - Windows |

重要的迁移说明2025.1

鉴于 2025.1 中的有些新增功能（参见 [新增功能概述 2025.1](whatsnew_2025_1_new_features.html) 章节），在迁移到 Wwise 2025.1 之前有些重要事项需要注意。

# 对 Application Binary Interface (ABI) 做了更改

对插件接口的二进制表示做了更改。所有插件都要针对 Wwise 2025.1 SDK 头文件重新编译才能在 Wwise Runtime 中加载。

# C/C++ API 改进

为了让特定类型能在 C 脚本中使用，并在不同平台之间具有更一致的表示，我们对 C++ API 的有些元素做了更改：

## External Source

[AkExternalSourceInfo::szFile](struct_ak_external_source_info_af29151c09e6b12f9b4f5b4c9a9389ba1.html#af29151c09e6b12f9b4f5b4c9a9389ba1 "UTF-8 File path for the source. If not NULL, the source will be streaming from disk....") 现在是 UTF-8 字符串 (`char*`) 而非 OS 原生字符串 (`AkOSChar*`)。

## 回调系统

对 PostEvent 回调签名进行了更改。将之前的回调信息结构拆分成了两个部分：

- 所有回调类型的通用数据作为指向 [AkEventCallbackInfo](struct_ak_event_callback_info.html) 结构的指针进行传递。该指针不得转换为别的类型。
- 特定于某个回调类型的数据作为 `void` 指针进行传递。根据 `in_eType` 参数的值将该指针转换为相应的回调信息结构类型。注意，对于有些不需要附加信息的回调类型（即 AK\_EndOfEvent、AK\_Starvation 和 AK\_MusicPlayStarted），此指针为 NULL。

另外，PostEvent 和 BusVolume 回调现在都将用户 Cookie 作为显式参数进行传递。而且，Cookie 不再存储在信息结构中。

## 其他小的类型更改及重命名

- 在全局命名空间中将 `AK::SoundEngine::AkActionOnEventType` 枚举类型重命名为了 `AkActionOnEventType`。它的值也做了类似的重命名。
- 在全局命名空间中将 `AK::AkAudioDeviceEvent` 枚举类型重命名为了 `AkAudioDeviceEvent`。它的值也做了类似的重命名。
- 在全局命名空间中将 `AK::SoundEngine::MultiPositionType` 枚举类型重命名为了 `AkMultiPositionType`。它的值也做了类似的重命名。
- 在全局命名空间中将 `AK::SoundEngine::DynamicSequence::DynamicSequenceType` 枚举类型重命名为了 `AkDynamicSequenceType`。它的值也做了类似的重命名。
- `AkMIDIPost` 结构体不再继承 `AkMIDIEvent`；现改为包含 `midiEvent` 数据成员。
- `AkWorldTransform` 和 `AkTransform` 现在是 `struct` 类型。
- 为避免跟实际的 WAVE 格式定义产生混淆，将 `WaveFormatExtensible` 重命名为了 `WemFormatExtensible`。

## 移除了 AkMusicEngine 库

移除了整个 AK::MusicEngine 命名空间、相关函数和库。AK::MusicEngine 的功能全部转到了 AK::SoundEngine。不过，其他运作方式与之前完全相同。 若游戏使用 Unity 或 Unreal，默认集成包也会有相应更改。而且，这一变更应当是透明的。 若游戏使用自研游戏引擎，这一变更会导致构建失败。要迁移代码，请执行以下步骤。

- 移除了 AkMusicEngine.lib/so 文件。对此，应当修改游戏构建脚本，来从链接器输入中移除库。
- 移除了 AK/MusicEngine/Common/AkMusicEngine.h 包含文件。对此，可移除所有指向此文件的 include 语句。
- 移除了 AK::MusicEngine::Init 和 AK::MusicEngine::Term are 函数。对此，只需将其连同对 AkMusicSettings 类型的引用从 Wwise 初始化代码中删除。
- 将 AK::MusicEngine::GetPlayingSegmentInfo 函数移到了 AK::SoundEngine::GetPlayingSegmentInfo。对此，可直接在代码中更改命名空间。

## 对AK::SoundEngine::GetSourcePlayPosition 和 AK\_EnableGetSourcePlayPosition 做了更改

现在默认追踪音频源的位置。无需将 `AK_EnableGetSourcePlayPosition` 标记传给 `AK::SoundEngine::PostEvent`。该标记已被直接移除。直接删除代码中对它的引用即可。

另外，`AK::SoundEngine::GetSourcePlayPosition()` 现在能返回更精确的位置。这一差异与播放延迟（由 `AkPlatformInitSettings::uNumRefillsInVoice` 定义）有关。在 25.1 之前，因为未计入延迟，所以报告的时间最多可能比实际播放的内容快 4 个缓冲区 (40 ~ 80 ms)。而且，还存在其他固有的时序不确定性来源。现在的时序精度应该精确到一个缓冲区 (10 ~ 20 ms)。

## 其他值得注意的移除项

移除了已被弃用的 `IAkVoicePluginInfo::ComputePriorityWithDistance`。

# 现在支持通过自定义 BankManager 线程执行异步操作

在将 `AkInitSettings::bUseSoundBankMgrThread` 设为 `false` 时，不再立即执行 SoundBank API 调用的异步变体。相反，这些操作会被添加到队列中。而且，游戏必须调用 `AK::SoundEngine::ProcessBanks` 来处理队列中的操作。有关如何自定义 Sound Engine 线程的详细信息，请参阅 [优化 CPU 用量](goingfurther_eventmgrthread.html) 章节。

若将 `AkInitSettings::bUseSoundBankMgrThread` 设为 `true`（默认值），则行为保持不变。

# Actor-Mixer Hierarchy、Master-Mixer Hierarchy 和 Interactive Music Hierarchy

此 Wwise 版本引入了对工程文件夹结构的重大更新。

对以下根节点进行了更新：

- **Audio Devices**：重命名为 **Devices**
- **Master-Mixer Hierarchy**：重命名为 **Busses**
- **Actor-Mixer Hierarchy**：重命名为 **Containers**
- **Interactive Music Hierarchy**：移到 **Containers** 并重命名为 **Music (Migrated)**

所有引用这些路径的工具、脚本或引擎都要更新。

注意，Wwise 提供有可将传入路径自动转换为新名称的别名机制。 比如，`\Actor-Mixer Hierarchy\SFX_CHARACTER\SFX_EXPL_01` 会自动转换为 `\Containers\SFX_CHARACTER\SFX_EXPL_01`。

SDK 函数 [AK::SoundEngine::SetActorMixerEffect](namespace_a_k_1_1_sound_engine_a00256bfd86c2bed14c626922fc4417b0.html#a00256bfd86c2bed14c626922fc4417b0) 重命名为了 AK::SoundEngine::SetContainerEffect。

## 在 WAAPI 和 WAQL 脚本中引用工程路径

工程结构更改会影响到 WAAPI 和 WAQL 脚本。所有引用上述路径的代码都会受到影响。

建议不要在客户端代码中对路径（如 `\Actor-Mixer Hierarchy\Default Work Unit`）进行硬编码。 相反，可改为调用 [ak.wwise.core.getProjectInfo](ak_wwise_core_getprojectinfo.html) 并检索 `defaultWorkUnits` 或 `defaultImportWorkUnit`。

注意，已经没有 **Interactive Music Hierarchy** 了。现在可直接在 **Containers** 层级结构下创建音乐对象。

## 在 Tab Delimited Import 文件中引用工程路径

工程结构更改还会影响到 Tab Delimited Import 文件。

确保对 Tab Delimited Import 生成器和电子表格进行更新来反映新的路径名称。

# 针对设计工具插件的属性更改

- InfiniteValue：该属性现在只能是整数属性类型。

# 将 Actor-Mixer 命名为了 Property Container

Actor-Mixer 对象现在叫 Property Container。

在 WAAPI、WAQL 以及 Tab Delimited Import 文件中，要分别由 Actor-Mixer 和 ActorMixer 改为使用 Property Container 和 PropertyContainer。

# 将 Master Audio Bus 重命名为了 Main Audio Bus

在创建新的工程时，现在会将之前的 Master Audio Bus 对象命名为 Main Audio Bus。对于新的工程，请将 WAAPI 和 WAQL 脚本更新为 Main Audio Bus；对于已有工程，请使用 Master Audio Bus。

# 将 MasterMixerConsole 重命名为了 BussesConsole

将 MasterMixerConsole 视图标识符重命名为了 BussesConsole。将 WAAPI 和 WAQL 脚本更新为 BussesConsole。

需要更新引用 MasterMixerConsole 视图的布局。

# 对 ObjectList 数据模型做了更改

对对象列表的内部结构做了更改。现在会以不同的方式访问有些对象列表中的对象。 以下列表现在包含引用 Wwise 对象的 InnerObject：**Arguments**、**EntryPath**、**Metadata**、**Playlist**。

- **Argument**：包含带 **Argument** 引用的 **ArgumentsSlot** InnerObject。**注意**：此项适用于 Dialogue Event 对象。
- **Argument**：包含带 **Argument** 引用的 **MusicArgumentsSlot** InnerObject。**注意**：此项适用于 Music Switch Container 对象。
- **EntryPath**：包含带 **EntryPathObject** 引用的 **EntryPathSlot** InnerObject。
- **Metadata**：包含带 **Metadata** 引用的 **MetadataSlot** InnerObject。
- **Playlist**：包含带 **PlaylistObject** 引用的 **PlaylistSlot** InnerObject。

## WAAPI 对象列表

下表列出了使用 ak.wwise.core.object.set 构建对象列表时的相关更改。

|  |  |
| --- | --- |
| **老样式** | **新样式** |
| "@Arguments": [object1, object2] | "@Arguments": [{"type": "ArgumentsSlot", "name": "", "@Argument": object1}, {"type": "ArgumentsSlot", "name": "", "@Argument": object2}]  **注意**：此项适用于 Dialogue Event 对象。 |
| "@Arguments": [object1, object2] | "@Arguments": [{"type": "MusicArgumentsSlot", "name": "", "@Argument": object1}, {"type": "MusicArgumentsSlot", "name": "", "@Argument": object2}]  **注意**：此项适用于 Music Switch Container 对象。 |
| "@EntryPath": [object1, object2] | "@EntryPath": [{"type": "EntryPathSlot", "name": "", "@EntryPathObject": object1}, {"type": "EntryPathSlot", "name": "", "@EntryPathObject": object2}] |
| "@Metadata": [object1, object2] | "@Metadata": [{"type": "MetadataSlot", "name": "", "@Metadata": object1}, {"type": "MetadataSlot", "name": "", "@Metadata": object2}] |
| "@Playlist": [object1, object2] | "@Playlist": [{"type": "PlaylistSlot", "name": "", "@PlaylistObject": object1}, {"type": "PlaylistSlot", "name": "", "@PlaylistObject": object2}] |

## WAQL 对象列表

下表列出了使用涉及对象列表的 WAQL 查询时的相关更改。

|  |  |
| --- | --- |
| **老样式** | **新样式** |
| where @metadata.any and @metadata.any(pluginname = "Wwise System Output Settings")  "\\Busses\\Default Work Unit\\Master Audio Bus\\BusA" select metadata.at(1)    return: ["metadata.at(1).name"] | where @metadata.any and @metadata.any(@metadata.pluginname = "Wwise System Output Settings")  "\\Busses\\Default Work Unit\\Master Audio Bus\\BusA" select metadata.at(1).metadata    return: ["metadata.at(1).metadata.name"]    from type plugininnerobject where pluginname = "metadataslot" select metadata.where(pluginname="Wwise System Output Settings") |
| from type randomsequencecontainer select playlist.where(type = "sound") | from type randomsequencecontainer select playlist.where(playlistobject.type = "sound") |
| where @Arguments.any(name = "StateGroup1") | where @Arguments.any(argument.name = "StateGroup1") |
| where @EntryPath.any(name = "State1") | where @EntryPath.any(entrypathobject.name = "State1") |

## 对命令 ID 名称做了更改

- 将 `ShowAudioFilesImporter` 命令重命名为了 `ShowAudioFileImporter`。

# 针对 Wwise Reflect 的属性更改

对多个与管理多普勒效果器相关的属性进行了更新。有些被弃用并在界面中隐藏，有些则引入了行为改进。

subsection reflect\_property\_changes\_25\_1\_renamed 重命名的属性

对以下属性进行了重命名，但是它们的功能保持不变：

- **Distance Smoothing**：重命名为 **Delay Smoothing**。
- **Pitch Threshold**：重命名为 **Pitch Limit**。

## 隐藏和弃用的属性

弃用了以下属性。它们依然存在，只不过界面中不显示。后续版本中会将其完全移除。

- **Smoothing Type**：隐藏并弃用。未来仅支持高效的 IIR 模式。
- **Threshold Mode**：隐藏并弃用。在 Continuous 模式下，新增了可通过新的 **Delay Error Tolerance** 属性访问的多普勒控制算法。它的行为跟之前的 Step 模式类似。
- **Distance Threshold**：隐藏并弃用。

Step 模式已被弃用。若要模拟其行为，请使用新的 **Delay Error Tolerance** 属性并将 **Pitch Limit** 设为较低的值。虽然与 **Distance Threshold** 相关，但 **Delay Error Tolerance** 将阈值定义为基于延迟的相对指标而非绝对距离。有关更多详细信息，请参阅 Reflect Help。

|  |  |
| --- | --- |
|  | **警告:** 若将 **Threshold Mode** 设为了 Step 但想更改已弃用的 **Distance Threshold** 或切换到改进后的 Continuous 模式，则需在 UI 中显示隐藏的属性。为此，请打开 Authoring\x64\Debug\bin\Plugins\AkReflect.xml，接着找到所需属性并将 `IsVisible="false"` 改为 `IsVisible="true"`。然后，重新打开 Wwise。 |

# 移除了 AK Expander 插件库

[AK](namespace_a_k.html "Definition of data structures for AkAudioObject") Expander 插件不再是独立的库或 DLL，它的所有功能已经移到 [AK](namespace_a_k.html "Definition of data structures for AkAudioObject") Compressor 库。需要移除为了编译而对 AkExpanderFX 库或 AkExpanderFXFactory 的引用或改为引用 AKCompressorFX 库。若对 Wwise 设计工具安装包进行了原地更新，请确保删除 Wwise 设计工具的 `Plugins` 目录下的 AkExpander 库，以避免因为插件 ID 重复导致工程加载出现错误。

# 对 Android 平台 Init Settings 做了更改

为了更好地控制 Android 上音频输出的初始化，移除了部分初始化设置并添加了新的初始化设置：

- 将 `AkPlatformInitSettings::bEnableLowLatency` 替换为了 `AkPlatformInitSettings::eAudioPath` 以便对延迟进行更精细的控制。如需了解如何设置此选项，请参阅有关 `AkAudioPath` 的文档内容。
- `AkPlatformInitSettings::eAudioAPI` 位域现在新增了两个用来管理如何在 Android 上使用 3D Audio API 的控制位：`AkAudioAPI_DolbyAtmos` 和 `AkAudioAPI_AndroidSpatializer`。

在绝大多数 Android 设备上，相应设置现在默认为使用 PerformanceMode=LowLatency 和 SharedMode=Shared 的 AAudio。这跟 Wwise 2024.1 有所不同。它默认为使用 PerformanceMode=LowLatency 和 SharedMode=Exclusive 的 AAudio。新的默认设置允许兼容更多设备，而且不会对延迟产生明显的影响。