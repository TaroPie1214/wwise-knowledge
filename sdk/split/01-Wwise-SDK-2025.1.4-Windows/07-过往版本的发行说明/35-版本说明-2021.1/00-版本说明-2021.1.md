# 版本说明 2021.1

|  |
| --- |
| Wwise SDK 2025.1.4 - Windows |

版本说明 2021.1

以下各节列举并阐述了 2019.2.8 和 2021.1 版本之间针对 Wwise 所作的改进。  
此处提供了有关平台的特定信息：

[Windows 和 Windows UWP 2021.1](windows_releasenotes_2021_1.html)

有关早期版本的信息，请参阅 [过往版本的发行说明](previousreleases.html) 章节。

- [新增功能](whatsnew_2021_1.html#generic_feature_changes_2021_1)
- [API 改进](whatsnew_2021_1.html#generic_api_changes_2021_1)
- [行为改进](whatsnew_2021_1.html#generic_behavior_changes_2021_1)
- [性能改进](whatsnew_2021_1.html#generic_perf_changes_2021_1)
- [其他改进](whatsnew_2021_1.html#generic_misc_2021_1)
- [漏洞修复](whatsnew_2021_1.html#generic_bugs_2021_1)
- [社区报告的漏洞修复](whatsnew_2021_1.html#generic_community_bugs_2021_1)

# 新增功能

- **WG-32040** 添加了新的查询语法 Wwise Authoring Query Language (WAQL)，大大增强了工程搜索功能。
- **WG-37429** 对各个视图中 Property Editor 的上半部分进行了统一调整以使界面更加简洁。
- **WG-40303** 添加了用户首选项以便选择字体样式和字体大小，从而提升操作的便捷性和界面的可读性。
- **WG-42535** 向 Remote Connection 选项添加了 **Profile Only** 模式。此新增选项方便快速连接到远程 PC 或游戏主机以实施性能分析，同时避免因意外同步而导致声音引擎对工程作出更改。
- **WG-43127** 重大插件 API 改进！现在可对混音总线进行基于对象的配置：
  - 弃用了混音器插件。
  - 新增了对象处理器效果器 `AK::IAkObjectAwareEffectPlugin`。
  - 移除了 `AK::IAkSourcePluginContext::NodeID`，改用 `AK::IAkVoicePluginInfo::GetAudioNodeID`。
  - `AK::IAkMixerPluginContext` 现可用于总线上插入的所有效果器。
  - 将 `AK::IAkMixerPluginContext::Compute3DPositioning()` in\_fSpread 和 in\_fFocus 参数的取值范围由 [0,100] 改为了 [0,1]。
- **WG-43531** (新的 Wwise 设计工具插件 API) 向 PropertySet 接口添加了 State 和 Linked 状态属性访问器。
- **WG-44017** 向 AkMemoryMgr 添加了 Stomp 分配器。可通过将 `AkMemSettings::uMemoryDebugLevel` 设为 2 来启用。此调试专用分配器采用“按次分配页面”形式的分配策略捕获大部分无效写入。注意，该分配器的运行速度很慢，并且会占用大量虚拟内存。因此，请在需要时使用其追踪特定问题，而不要设为在开发时默认启用。
- **WG-46032** (WAAPI) 添加了 `ak.wwise.core.profiler.enableProfilerData` 调用，以允许通过 WAAPI 获取性能分析数据。
- **WG-46426** 在 Query Editor 中添加了新的字段以便执行 WAQL 查询。
- **WG-46885** 在 Segment Editor 中添加了新的菜单，以便在 Multi Editor 中调节 Custom Cue 的时间，并设置 Custom Cue 标记点的颜色。
- **WG-46920** 添加了 `AK::MemoryMgr::DumpToFile`，以允许将当前分配转储到文件。
- **WG-46966** 为 AkMemoryMgr 添加了运行时内存调试功能，可通过 `AkMemSettings::uMemoryDebugLevel` 访问。藉此，可追踪内存泄漏并执行基本的完好度检查。
- **WG-47071** 在 Wwise 外部对 Work Unit 文件实施更改后，Wwise 现在只尝试重新加载存在更改的 Work Unit 而非重新加载整个工程。
- **WG-47308** 新增了实验性的 WEM Opus 编解码器以提高寻址行为的效率。
- **WG-47415** 进一步增强了 Effect Editor 的易用性，以便在效果器显示监控信息时执行相应操作。
- **WG-47487** 在 Conversion Settings 中添加了两个新的选项，以便将导入的声音强制转码为 5.1 或 7.1 格式。
- **WG-47492** 在父总线采用基于对象的配置时，Wwise Reflect 效果器插件现在可输出 Audio Object。
- **WG-47542** 向 API 添加了两个新的 Spatial Audio 函数，以便在不使用衍射和几何构造的情况下为路径添加声障效果。这两个新增函数为：
  - `AKRESULT SetGameObjectToPortalObstruction(AkGameObjectID in_gameObjectID, AkPortalID in_portalObjectID, AkReal32 in_fObstruction)`
  - `AKRESULT SetPortalToPortalObstruction(AkPortalID in_portalObjectID0, AkPortalID in_portalObjectID1, AkReal32 in_fObstruction)`
- **WG-47794** 为 `AK::MemoryMgr` 添加了 Debug C 运行时分配器挂钩。
- **WG-47948** 改进了 Color Picker 按钮的外观并优化了调色板。
- **WG-48049** Bus Property Editor 现在可显示更多有关总线处理状态的信息。
- **WG-48356** 移除了 Opus 编码器的 Frame Size 参数。不但不会影响编码品质，反而有助提升解码性能。
- **WG-48591** 针对音乐过渡添加了上级/下级对象筛选功能。
- **WG-48609** 默认断言处理程序现在会列出堆栈跟踪信息。
- **WG-48612** 添加了 Memory Manager 分配追踪系统。
- **WG-48811** 添加了工具提示以在 Music Segment Editor 中显示 Custom Cue 的时间。
- **WG-49192** 向 Remote Connections 对话框添加了 Ping 列。
- **WG-49210** (Mac Authoring) 现在提供 3D 视图。
- **WG-49453** 添加了相应信息来指示总线是否在进行混音处理。若正在进行混音，则显示总线图标。电平表标题也会指示是否正在进行混音。同时，工具提示会指示为何进行混音。
- **WG-49658** (WAAPI) 添加了 `ak.wwise.core.profiler.getAudioObjects`，以从性能分析会话检索 Audio Object。除此之外，现在 `ak.wwise.core.profiler.getVoices` 和 `ak.wwise.core.profiler.getBusses` 还可使用管线 ID 来获取各个声部或总线。
- **WG-49689** System Audio Device 现在会显示性能分析信息。
- **WG-49906** 使用 Audiokinetic 的 WEM Opus 编码器替换了原有的 Opus 编解码器。
- **WG-49923** 添加了 System Audio Device 对 3D Audio 的支持。
- **WG-50144** 现在启用 Game Object 3D Viewer 时，会显示发声体散布声锥。既可按照声音的 Attenuation ShareSet 定义来显示，也可依据 Spatial Audio 计算结果来显示（如使用 Radial Emitter、Room 和 Portal）。
- **WG-50198** 添加了相应设置以便在 Game Object 3D Viewer 中更改文本大小。
- **WG-50261** 现在允许在 Music Switch Container 下创建 Work Unit。
- **WG-50456** 向 Performance Monitor 添加了可折叠分隔器以便显示或隐藏 Value 列表。
- **WG-50503** (新的 Wwise 设计工具插件 API) 向 DataWriter 添加了写入函数以确保与 PropertySet 接口保持一致。
- **WG-50632** 添加了键盘快捷方式 F2 以便重命名 Transition Matrix 中的 Transition。
- **WG-50699** (Mac Authoring) 添加了相应菜单选项以便检测工程和 Work Unit 更改。
- **WG-50780** 添加了新的上下文菜单，可在按住 SHIFT 键时显示，方便生成 WAQL 查询并将其复制到剪贴板。
- **WG-50972** 现在 Mastering Suite 中支持基于对象的电平测量。
- **WG-51105** Spatial Audio：现在 Spatial Audio Emitter 完全支持 `AK::SoundEngine::SetMultiplePositions`。Spatial Audio 现在会针对各个声音位置计算衍射、透射和反射路径。
- **WG-51107** Spatial Audio：Game Object 3D Viewer 中现在会显示透射路径以及关联透射损失（表示为百分比值）。
- **WG-51236** 增添了 Music Transition 筛选功能，并在 Music Switch Container 下添加了 Work Unit。
- **WG-51261** Spatial Audio：对于针对湿声路径中各条通路计算的透射损失值，现在会取上游和下游 Room 当中的最大值。之前，都是取通路和听者上游 Room 当中的最大值。
- **WG-51277** 向 List View 添加了 Plug-in Name 列。
- **WG-51315** (WAAPI) 添加了访问器 pluginName。
- **WG-51347** Spatial Audio：现在会针对穿过一个或多个 Portal 的所有声音路径计算 Aperture 值。Aperture 值代表路径上的最小 Portal 开口，其依据相对于听者的近似立体角测定。Aperture 值可用于限制声音的最大散布范围。现在可在 Advanced Profiler 的 Obs/Occ 选项卡中查看该值。
- **WG-51421** Spatial Audio：对 Portal Spread 计算的算法进行了改进。新的算法更加高效，并可在听者偏离 Portal 轴线 90 度时避免散布缩减为 0。
- **WG-51465** Spatial Audio：添加了新的 API `AK::SpatialAudio::SetGameObjectRadius` 以为圆形声源提供支持。
- **WG-51541** Spatial Audio：针对 Transmission Loss 添加了新的内置 Game Parameter。
- **WG-51581** 现在只要插件在 Unlinked 模式下处理基于对象的音频，Mastering Suite 中就会显示警告图标。
- **WG-51650** Spatial Audio：从 Portal 开口边角沿径向向外拓展了 Portal 过渡区域，以确保在从侧方进入 Portal 时能够无缝衔接。
- **WG-51677** 现在即便未开启捕获也可显示实时插件监控数据。
- **WG-51772** 电平表现在可显示所捕获性能分析会话的电平历史记录。
- **WG-51879** Spatial Audio：当 Room 之间通过被禁用的 Portal 连接时，混响和房间底噪现在可以通过透射路径传播。在不需要在 Room 之间构建衍射路径时，可使用被禁用的 Portal 将 Room 连在一起，以此来专门模拟混响的透射。

# API 改进

- **WG-44180** (WAAPI) 现在可通过查询根路径 \ 来访问 Project 对象。在查询工程的路径时，现在会返回 \。
- **WG-47068** (WAAPI) 对于包含 : 字符的访问器，现在可同时用作不带分号的别名。详见 `ak.wwise.core.object.get` 章节。
- **WG-47378** `AK::IAkMixerPluginContext::Compute3DPositioning` 现在在 0 ~ 1 之间取 Spread 和 Focus 值。
- **WG-47493** (WAAPI) 命令 `ShowListView`、`ShowSchematicView` 和 `Search` 现在可采用文本值（即字符串）来搜索工程中的文本。
- **WG-47651** 实施了如下改进：
  - 改进了函数 `PostMIDIOnEvent` 和 `StopMIDIOnEvent` 以为 Playing ID 提供支持。同时，添加了新的 `AkMIDIEvent` 类型 `AK_MIDI_EVENT_TYPE_WWISE_CMD`。
  - 为 `AkSourcePosition` 添加了成员 `updateBufferTick`，来表示更新位置后的 `GetBufferTick()` 值。
  - 添加了函数 `GetSampleTick()`。其等同于 `GetBufferTick()` \* `AkAudioSettings.uNumSamplesPerFrame`。
- **WG-48177** 向 Memory Manager 接口添加了 Aligned Realloc。
- **WG-48344** 合并了 rpmalloc 1.4。现在使用 rpmalloc 一级内存堆分配媒体以降低缓存用量。
- **WG-48570** 移除了 `AK_ALIGN_DMA、AK_ALIGN_FASTDMA` 和 `AK_ALIGN_SIZE_FOR_DMA` 宏。所有对这些宏的应用都可以被移除，因为它们很多年都没有做任何定义。
- **WG-48746** 添加了新的插件服务 `AK::IAkMixerPluginContext::ComputePositioning` 以计算声像摆位增益。
- **WG-49885** SpatialAudio API 更新：AkPortalParams Extent 类型由 [AkVector](struct_ak_vector.html "3D vector for some operations in 3D space. Typically intended only for localized calculations due to ...") 改为了 AkExtent，其包含 halfWidth、halfHeight 和 halfDepth 成员。这些成员变量需要由游戏依据对应的坐标系加以设定。
- **WG-50061** `AK::IAkVoicePluginInfo` 不再沿用 `AK::IAkGameObjectPluginInfo`，因为总线也会与游戏对象关联。将 `IAkPluginContextBase::GetAudioNodeID()` 推送给了 `IAkPluginContextBase`，并移除了重复的访问器（如 GetBusID）。
- **WG-50236** 重写了 Wwise 设计工具插件 API，以便更好地分离关注点，并提升兼容能力。
- **WG-50501** 从原有插件 API 中移除了不支持的 `WritePascalString` 和 `WriteUtf16String` 函数。
- **WG-50872** (WAAPI) 在用词上，将“皮肤”改为了“主题”。将命令 `ReloadCurrentSkin` 重命名为了 `ReloadCurrentTheme`。
- **WG-51017** 将 `AK::IAkGlobalPluginContext` 中与混音相关的一些函数（`MixChannel`、`Mix1inNChannels`、`MixNinNChannels`、`ApplyGain` 和 `ApplyGainAndInterleave`）转到了新的接口 `AK::IAkPluginServiceMixer` 中。您可以通过调用 `AK::IAkGlobalPluginContext::GetPluginService()` 或使用 `AK_GET_PLUGIN_SERVICE_MIXER` 宏来获取该接口。稍后会逐步向该接口添加其他信号处理函数以及其他服务接口，以便插件开发人员充分利用 Wwise 内的现有效果器功能，并有效运用特定于处理器的增强功能。
- **WG-51251** 重大改进！通过移除 Debug 版本的函数简化了插件分配接口 `IAkPluginMemAlloc`。将内存调试功能隐藏到了插件宿主中。
- **WG-51622** 针对插件 API 向 `NotifyMonitorData` 添加了时间戳。
- **WG-51809** (新的 Wwise 设计工具插件 API) 从监控函数中移除了字节交换标记（假定采用 Little Endian 编码）。
- **WG-52710** - 向 [AkDiffractionPathInfo](struct_ak_diffraction_path_info.html) 添加了 emitterPos 字段，以便在使用 QueryDiffractionPaths API 时返回衍射路径中所用的发声体位置。
- 向 [AkDiffractionPathInfo](struct_ak_diffraction_path_info.html) 添加了 transmissionLoss 字段，以便在使用 QueryDiffractionPaths API 时返回有关发声体当前透射损失的信息。
- **WG-53241** 从 [PlatformID](namespace_platform_i_d.html) 命名空间中移除了被弃用的平台。

# 行为改进

- **WG-48027** 在 Spatial Audio 中，针对穿过 Portal 的湿声路径改进了散布计算。
- **WG-48038** 在输出总线的声道配置为全 3D 时（即包含高度声道、采用 Ambisonics 格式且基于对象），Spread 和 Focus 计算当中所用的距离现在与发声体和听者之间的实际距离相符。
- **WG-48178** [AkArray](class_ak_array.html "Specific implementation of array") 现在使用 Aligned Realloc。
- **WG-48575** 内存不足消息现在会同时显示内存类型的相关信息。
- **WG-50447** 所有 Wwise 混响效果器中均添加了预延迟参数专用 RTPC 的支持，便于在播放之前初始化预延迟。
- **WG-50776** 当 Room 之间仅存在被禁用的 Portal，现在声音也可以传播。
- **WG-52087** 现在每一帧都会报告性能指标。
- **WG-53299** 改进了全局回调位置 AkGlobalCallbackLocation\_PostMessagesProcessed 的行为，现在每次渲染缓冲区时仅执行一次回调。现在只会在当前缓冲区和上一缓冲区之间处理消息之后执行回调，之前在有多批要处理的消息时每次渲染缓冲区都会多次执行回调。不过，回调的位置并没有改变。

# 性能改进

- **WG-47172** 提升了音频重新采样算法的性能。在启用 AVX2 的情况下，效果尤为明显。最主要的是，这样应可在播放大部分 Vorbis 音频源时将吞吐量性能提高 10。
- **WG-47544** 针对运用傅里叶变换 (FFT) 算法的效果器做了性能提升，尤其是在激活并启用了 AVX2 的平台上。藉此实现了多项改进，比如：
  - 将 Convolution Reverb 和 Filter 效果器的吞吐量性能提升了 1.3 ~ 1.7 倍。
  - 将 Harmonizer 和 Time Stretch 效果器的吞吐量性能提升了 1.5 ~ 1.75 倍。
- **WG-51121** 对 Mastering Suite 中 Limiter 模块的 Advanced 模式进行了优化。该模块现在的效率比之前提高了 37。
- **WG-51334** 降低了 Spatial Audio 监控数据的内存用量。
- **WG-51775** 对电平表进行了优化，提升了其绘制性能。

# 其他改进

- **WG-41575** 现在 Profiler Settings 中默认启用 Obstruction/Occlusion Data 和 SoundBank Data。
- **WG-45796** 将 Make-Up Gain 属性从 Source Settings 转到了 General Settings。
- **WG-47656** 在 IntegrationDemo 中添加了新的 3D Audio Object 演示页面。
- **WG-48720** 现在不再支持直接从 2013.1 之前的版本迁移 Wwise 工程。如有必要，可先迁移到 2019.2，再迁移到 2021.1。
- **WG-50376** 从 Reflect 中分离了 Acoustic Texture 出厂素材。
- **WG-50769** 现在可导入 192 kHz 音频文件。
- **WG-51039** 针对 AkSpatialAudioVolume 更新了 Unreal Editor 中的 Details 面板。现在可针对多个 Spatial Audio Volume 的不同表面更改 Surface Reflector。
- **WG-51169** 现在需要在 Audio Device 而非 Master Audio Bus 上插入 Mastering Suite 效果器。
- **WG-51546** 将 Room Extent Opacity 滑杆转到了 Game Object 3D Viewer Settings 中的 Spatial Audio Debug 分区。

# 漏洞修复

- **WG-41982** 已修复：(Windows Authoring) 崩溃转储显示错误的 OS 版本号。
- **WG-43214** 已修复：在 Windows 上使用设计工具时，无法在磁盘的根目录下生成 SoundBank。
- **WG-44531** 已修复：Wwise Wave Viewer 对文件进行了锁定。
- **WG-45632** 已修复：用户可在暂停时在 Source Editor 中移动辅助播放光标。
- **WG-46046** 已修复：在滚动 Game Sync Monitor 和 Voices Monitor 的标尺时出现画面卡顿。
- **WG-46286** 已修复：在执行 move-media-ids-to-single-file 和 move-media-ids-to-work-units 操作的过程中，WwiseConsole.exe 没有提供反馈。
- **WG-46388** 已修复：在没有使用 Commcentral.lib 的情况下实施性能分析时，非必要依赖项强行与之建立链接。
- **WG-46564** 已修复：对于引用多个媒体项的插件，媒体修改不会立即生效。
- **WG-47257** 已修复：在使用无效名称创建新的工程时，**OK** 和 **Cancel** 按钮操作出现画面卡顿。
- **WG-47312** 已修复：即便没有短 ID 可用也会显示 Copy Short ID(s) to Clipboard 菜单。
- **WG-48209** 已修复：在单击 Project Explorer 窗口的有些地方时没有任何反应。
- **WG-48719** 已修复：在听者进入另一封闭的 Room 时重复应用 Room Tone 湿声路径声笼。
- **WG-48757** 已修复：在键盘焦点处于列表内的复选框上时按下空格键无法触发播放行为。
- **WG-48798** 已修复：Property Editor 的标题栏无法反映当前选定对象。
- **WG-49197** 已修复：File Manager 对话框中的文件夹路径有时会丢失或错位。
- **WG-49720** 已修复：无法在 Property Editor 中使用键盘快捷方式（CTRL+1、CTRL+2 等）切换选项卡。
- **WG-49807** 已修复：在播放期间更改 Mastering Suite 中的 ShareSet 会产生可辨的杂音。
- **WG-50027** 已修复：(WAAPI) 在通过 WAAPI 执行命令 OpenContainingFolderWorkUnit、OpenContainingFolderWAV 和 OpenContainingFolderSoundbank 时发生故障。
- **WG-50155** 已修复：在插件 API 1.0 和 2.0 中改写 GetDialog 时，如未设置任何输出参数，便会发生崩溃。
- **WG-50227** 已修复：在使用多个监视器并启用 High DPI 时拖动滑杆会发生不符合预期的行为。
- **WG-50337** 已修复：只有在针对 Master-Mixer Hierarchy 下的总线启动捕获会话时才能正常显示电平表。
- **WG-50432** 已修复：在将游戏对象静音时，无法在 Game Sync Monitor 中执行 Mute 和 Solo 筛选操作。
- **WG-50668** 已修复：在 Vorbis 转码过程中无法正常清理某些临时文件。
- **WG-50702** 已修复：无法在 High DPI 显示器上正常显示 Wave Viewer。
- **WG-50906** 已修复：在游戏对象既是发声体又是听者时重复应用游戏对象缩放系数。
- **WG-51726** 已修复：颜色选择器在靠近屏幕边缘时会消失。
- **WG-52515** 已修复：在移动包含 Wwise 对象的嵌套文件夹时，WAAPI 素材同步出现问题。
- **WG-52517** 已修复：在更改平台后无法正确更新 All Properties 选项卡。
- **WG-52754** 已修复：在执行 AkTransitionManager::ProcessTransitionList 时，声音引擎发生罕见崩溃。
- **WG-52896** 已修复：将声障应用到了用作早期反射总线的 Auxiliary Bus 的输出。这样做是不可取的。因为在 Spatial Audio 中会单独对每个反射声（镜像声源）进行评估，最终会根据实际需要确定是否应用声障效果。
- **WG-53142** 已修复：AkMemSettings::uMemAllocationSizeLimit 有可能会超出设备内存大小。
- **WG-53325** 已修复：自定义关联混音器插件 GUI 的大小设定有误。

# 社区报告的漏洞修复

- **WG-47156** 已修复：在发出准备请求时发生死锁。
- **WG-48504** 已修复：在启动时，有些 Wwise 线程没有调用 `AK::MemoryMgr::InitForThread`。
- **WG-49195** 已修复：在 SoundBank 生成过程中执行生成前和生成后操作时可能会发生崩溃。
- **WG-51912** 已修复：无法更改 Audio File Conversion 错误的严重性。
- **WG-52764** 已修复：在使用主菜单时可能会发生崩溃。
- **WG-53081** 已修复：在 Portal 关闭后终止 Unreal 游戏时报告了未知的 Game Object ID。

参见
:   - [新功能概述2021.1](whatsnew_2021_1_new_features.html)
    - [重要的迁移说明2021.1](whatsnew_2021_1_migration.html)